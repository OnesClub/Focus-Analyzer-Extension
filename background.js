/*! For license information please see background.js.LICENSE.txt */
(()=>{"use strict";var t={};t.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}();const e=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},n={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,n){return this.HAS_NATIVE_SUPPORT&&!n?btoa(t):this.encodeByteArray(e(t),n)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==o||null==a||null==c)throw new r;const u=s<<2|o>>4;if(i.push(u),64!==a){const t=o<<4&240|a>>2;if(i.push(t),64!==c){const t=a<<6&192|c;i.push(t)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class r extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const i=function(t){return function(t){const r=e(t);return n.encodeByteArray(r,!0)}(t).replace(/\./g,"")};const s=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==t.g)return t.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return n.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},o=()=>{var t;return null===(t=s())||void 0===t?void 0:t.config};class a{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch(()=>{}),1===t.length?t(e):t(e,n))}}}function c(t){return t.endsWith(".cloudworkstations.dev")}const u={};let h=!1;function l(t,e){if("undefined"==typeof window||"undefined"==typeof document||!c(window.location.host)||u[t]===e||u[t]||h)return;function n(t){return`__firebase__banner__${t}`}u[t]=e;const r="__firebase__banner",i=function(){const t={prod:[],emulator:[]};for(const e of Object.keys(u))u[e]?t.emulator.push(e):t.prod.push(e);return t}().prod.length>0;function s(){const t=function(t){let e=document.getElementById(t),n=!1;return e||(e=document.createElement("div"),e.setAttribute("id",t),n=!0),{created:n,element:e}}(r),e=n("text"),s=document.getElementById(e)||document.createElement("span"),o=n("learnmore"),a=document.getElementById(o)||document.createElement("a"),c=n("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(t.created){const e=t.element;!function(t){t.style.display="flex",t.style.background="#7faaf0",t.style.position="fixed",t.style.bottom="5px",t.style.left="5px",t.style.padding=".5em",t.style.borderRadius="5px",t.style.alignItems="center"}(e),function(t,e){t.setAttribute("id",e),t.innerText="Learn more",t.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",t.setAttribute("target","__blank"),t.style.paddingLeft="5px",t.style.textDecoration="underline"}(a,o);const n=function(){const t=document.createElement("span");return t.style.cursor="pointer",t.style.marginLeft="16px",t.style.fontSize="24px",t.innerHTML=" &times;",t.onclick=()=>{h=!0,function(){const t=document.getElementById(r);t&&t.remove()}()},t}();!function(t,e){t.setAttribute("width","24"),t.setAttribute("id",e),t.setAttribute("height","24"),t.setAttribute("viewBox","0 0 24 24"),t.setAttribute("fill","none"),t.style.marginLeft="-6px"}(u,c),e.append(u,s,a,n),document.body.appendChild(e)}i?(s.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',s.innerText="Preview backend running in this workspace."),s.setAttribute("id",e)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",s):s()}function d(){return!function(){var e;const n=null===(e=s())||void 0===e?void 0:e.forceEnvironment;if("node"===n)return!0;if("browser"===n)return!1;try{return"[object process]"===Object.prototype.toString.call(t.g.process)}catch(t){return!1}}()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}class f extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,p.prototype.create)}}class p{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(g,(t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`})}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new f(r,o,n)}}const g=/\{\$([^}]+)}/g;function m(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(y(n)&&y(s)){if(!m(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function y(t){return null!==t&&"object"==typeof t}function v(t){return t&&t._delegate?t._delegate:t}class w{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const b="[DEFAULT]";class E{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new a;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:b})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=b){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...t.filter(t=>"_delete"in t).map(t=>t._delete())])}isComponentSet(){return null!=this.component}isInitialized(t=b){return this.instances.has(t)}getOptions(t=b){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===b?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=b){return this.component?this.component.multipleInstances?t:b:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class T{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new E(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const _=[];var C;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(C||(C={}));const I={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},S=C.INFO,A={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},D=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=A[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class k{constructor(t){this.name=t,this._logLevel=S,this._logHandler=D,this._userLogHandler=null,_.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in C))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?I[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...t),this._logHandler(this,C.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...t),this._logHandler(this,C.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,C.INFO,...t),this._logHandler(this,C.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,C.WARN,...t),this._logHandler(this,C.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...t),this._logHandler(this,C.ERROR,...t)}}let N,x;const R=new WeakMap,O=new WeakMap,L=new WeakMap,M=new WeakMap,P=new WeakMap;let V={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return O.get(t);if("objectStoreNames"===e)return t.objectStoreNames||L.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return U(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function F(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(B(this),t),U(R.get(this))}:function(...t){return U(e.apply(B(this),t))}:function(t,...n){const r=e.call(B(this),t,...n);return L.set(r,t.sort?t.sort():[t]),U(r)}:(t instanceof IDBTransaction&&function(t){if(O.has(t))return;const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)});O.set(t,e)}(t),n=t,(N||(N=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(t=>n instanceof t)?new Proxy(t,V):t);var e,n}function U(t){if(t instanceof IDBRequest)return function(t){const e=new Promise((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(U(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)});return e.then(e=>{e instanceof IDBCursor&&R.set(e,t)}).catch(()=>{}),P.set(e,t),e}(t);if(M.has(t))return M.get(t);const e=F(t);return e!==t&&(M.set(t,e),P.set(e,t)),e}const B=t=>P.get(t),j=["get","getKey","getAll","getAllKeys","count"],q=["put","add","delete","clear"],$=new Map;function z(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if($.get(e))return $.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=q.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!j.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return $.set(e,s),s}var K;K=V,V={...K,get:(t,e,n)=>z(t,e)||K.get(t,e,n),has:(t,e)=>!!z(t,e)||K.has(t,e)};class H{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null}).filter(t=>t).join(" ")}}const G="@firebase/app",Q="0.13.1",W=new k("@firebase/app"),X="@firebase/app-compat",Y="@firebase/analytics-compat",J="@firebase/analytics",Z="@firebase/app-check-compat",tt="@firebase/app-check",et="@firebase/auth",nt="@firebase/auth-compat",rt="@firebase/database",it="@firebase/data-connect",st="@firebase/database-compat",ot="@firebase/functions",at="@firebase/functions-compat",ct="@firebase/installations",ut="@firebase/installations-compat",ht="@firebase/messaging",lt="@firebase/messaging-compat",dt="@firebase/performance",ft="@firebase/performance-compat",pt="@firebase/remote-config",gt="@firebase/remote-config-compat",mt="@firebase/storage",yt="@firebase/storage-compat",vt="@firebase/firestore",wt="@firebase/ai",bt="@firebase/firestore-compat",Et="firebase",Tt="[DEFAULT]",_t={[G]:"fire-core",[X]:"fire-core-compat",[J]:"fire-analytics",[Y]:"fire-analytics-compat",[tt]:"fire-app-check",[Z]:"fire-app-check-compat",[et]:"fire-auth",[nt]:"fire-auth-compat",[rt]:"fire-rtdb",[it]:"fire-data-connect",[st]:"fire-rtdb-compat",[ot]:"fire-fn",[at]:"fire-fn-compat",[ct]:"fire-iid",[ut]:"fire-iid-compat",[ht]:"fire-fcm",[lt]:"fire-fcm-compat",[dt]:"fire-perf",[ft]:"fire-perf-compat",[pt]:"fire-rc",[gt]:"fire-rc-compat",[mt]:"fire-gcs",[yt]:"fire-gcs-compat",[vt]:"fire-fst",[bt]:"fire-fst-compat",[wt]:"fire-vertex","fire-js":"fire-js",[Et]:"fire-js-all"},Ct=new Map,It=new Map,St=new Map;function At(t,e){try{t.container.addComponent(e)}catch(n){W.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function Dt(t){const e=t.name;if(St.has(e))return W.debug(`There were multiple attempts to register component ${e}.`),!1;St.set(e,t);for(const e of Ct.values())At(e,t);for(const e of It.values())At(e,t);return!0}const kt=new p("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class Nt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new w("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw kt.create("app-deleted",{appName:this._name})}}function xt(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:Tt,automaticDataCollectionEnabled:!0},e),i=r.name;if("string"!=typeof i||!i)throw kt.create("bad-app-name",{appName:String(i)});if(n||(n=o()),!n)throw kt.create("no-options");const s=Ct.get(i);if(s){if(m(n,s.options)&&m(r,s.config))return s;throw kt.create("duplicate-app",{appName:i})}const a=new T(i);for(const t of St.values())a.addComponent(t);const c=new Nt(n,r,a);return Ct.set(i,c),c}function Rt(t,e,n){var r;let i=null!==(r=_t[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void W.warn(t.join(" "))}Dt(new w(`${i}-version`,()=>({library:i,version:e}),"VERSION"))}const Ot="firebase-heartbeat-store";let Lt=null;function Mt(){return Lt||(Lt=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=U(o);return r&&o.addEventListener("upgradeneeded",t=>{r(U(o.result),t.oldVersion,t.newVersion,U(o.transaction),t)}),n&&o.addEventListener("blocked",t=>n(t.oldVersion,t.newVersion,t)),a.then(t=>{s&&t.addEventListener("close",()=>s()),i&&t.addEventListener("versionchange",t=>i(t.oldVersion,t.newVersion,t))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(Ot)}catch(t){console.warn(t)}}}).catch(t=>{throw kt.create("idb-open",{originalErrorMessage:t.message})})),Lt}async function Pt(t,e){try{const n=(await Mt()).transaction(Ot,"readwrite"),r=n.objectStore(Ot);await r.put(e,Vt(t)),await n.done}catch(t){if(t instanceof f)W.warn(t.message);else{const e=kt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}function Vt(t){return`${t.name}!${t.options.appId}`}class Ft{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Bt(e),this._heartbeatsCachePromise=this._storage.read().then(t=>(this._heartbeatsCache=t,t))}async triggerHeartbeat(){var t,e;try{const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Ut();if(null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)&&(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))return;if(this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(t=>t.date===r))return;if(this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats.length>30){const t=function(t){if(0===t.length)return-1;let e=0,n=t[0].date;for(let r=1;r<t.length;r++)t[r].date<n&&(n=t[r].date,e=r);return e}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(t,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){W.warn(t)}}async getHeartbeatsHeader(){var t;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ut(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find(t=>t.agent===i.agent);if(t){if(t.dates.push(i.date),jt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),jt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=i(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return W.warn(t),""}}}function Ut(){return(new Date).toISOString().substring(0,10)}class Bt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!function(){try{return"object"==typeof indexedDB}catch(t){return!1}}()&&new Promise((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=(await Mt()).transaction(Ot),n=await e.objectStore(Ot).get(Vt(t));return await e.done,n}catch(t){if(t instanceof f)W.warn(t.message);else{const e=kt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return Pt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function jt(t){return i(JSON.stringify({version:2,heartbeats:t})).length}Dt(new w("platform-logger",t=>new H(t),"PRIVATE")),Dt(new w("heartbeat",t=>new Ft(t),"PRIVATE")),Rt(G,Q,""),Rt(G,Q,"esm2017"),Rt("fire-js",""),Rt("firebase","11.9.1","app");var qt,$t,zt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Kt={};(function(){var t;function e(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.B=Array(this.blockSize),this.o=this.h=0,this.s()}function n(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function r(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}!function(t,e){function n(){}n.prototype=e.prototype,t.D=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.C=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}(e,function(){this.blockSize=-1}),e.prototype.s=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},e.prototype.u=function(t,e){void 0===e&&(e=t.length);for(var r=e-this.blockSize,i=this.B,s=this.h,o=0;o<e;){if(0==s)for(;o<=r;)n(this,t,o),o+=this.blockSize;if("string"==typeof t){for(;o<e;)if(i[s++]=t.charCodeAt(o++),s==this.blockSize){n(this,i),s=0;break}}else for(;o<e;)if(i[s++]=t[o++],s==this.blockSize){n(this,i),s=0;break}}this.h=s,this.o+=e},e.prototype.v=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.o;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.u(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var i={};function s(t){return-128<=t&&128>t?function(t){var e=i;return Object.prototype.hasOwnProperty.call(e,t)?e[t]:e[t]=function(t){return new r([0|t],0>t?-1:0)}(t)}(t):new r([0|t],0>t?-1:0)}function o(t){if(isNaN(t)||!isFinite(t))return a;if(0>t)return d(o(-t));for(var e=[],n=1,i=0;t>=n;i++)e[i]=t/n|0,n*=4294967296;return new r(e,0)}var a=s(0),c=s(1),u=s(16777216);function h(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function l(t){return-1==t.h}function d(t){for(var e=t.g.length,n=[],i=0;i<e;i++)n[i]=~t.g[i];return new r(n,~t.h).add(c)}function f(t,e){return t.add(d(e))}function p(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function g(t,e){this.g=t,this.h=e}function m(t,e){if(h(e))throw Error("division by zero");if(h(t))return new g(a,a);if(l(t))return e=m(d(t),e),new g(d(e.g),d(e.h));if(l(e))return e=m(t,d(e)),new g(d(e.g),e.h);if(30<t.g.length){if(l(t)||l(e))throw Error("slowDivide_ only works with positive integers.");for(var n=c,r=e;0>=r.l(t);)n=y(n),r=y(r);var i=v(n,1),s=v(r,1);for(r=v(r,2),n=v(n,2);!h(r);){var u=s.add(r);0>=u.l(t)&&(i=i.add(n),s=u),r=v(r,1),n=v(n,1)}return e=f(t,i.j(e)),new g(i,e)}for(i=a;0<=t.l(e);){for(n=Math.max(1,Math.floor(t.m()/e.m())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),u=(s=o(n)).j(e);l(u)||0<u.l(t);)u=(s=o(n-=r)).j(e);h(s)&&(s=c),i=i.add(s),t=f(t,u)}return new g(i,t)}function y(t){for(var e=t.g.length+1,n=[],i=0;i<e;i++)n[i]=t.i(i)<<1|t.i(i-1)>>>31;return new r(n,t.h)}function v(t,e){var n=e>>5;e%=32;for(var i=t.g.length-n,s=[],o=0;o<i;o++)s[o]=0<e?t.i(o+n)>>>e|t.i(o+n+1)<<32-e:t.i(o+n);return new r(s,t.h)}(t=r.prototype).m=function(){if(l(this))return-d(this).m();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.i(n);t+=(0<=r?r:4294967296+r)*e,e*=4294967296}return t},t.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(h(this))return"0";if(l(this))return"-"+d(this).toString(t);for(var e=o(Math.pow(t,6)),n=this,r="";;){var i=m(n,e).g,s=((0<(n=f(n,i.j(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(h(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},t.i=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},t.l=function(t){return l(t=f(this,t))?-1:h(t)?0:1},t.abs=function(){return l(this)?d(this):this},t.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0,s=0;s<=e;s++){var o=i+(65535&this.i(s))+(65535&t.i(s)),a=(o>>>16)+(this.i(s)>>>16)+(t.i(s)>>>16);i=a>>>16,o&=65535,a&=65535,n[s]=a<<16|o}return new r(n,-2147483648&n[n.length-1]?-1:0)},t.j=function(t){if(h(this)||h(t))return a;if(l(this))return l(t)?d(this).j(d(t)):d(d(this).j(t));if(l(t))return d(this.j(d(t)));if(0>this.l(u)&&0>t.l(u))return o(this.m()*t.m());for(var e=this.g.length+t.g.length,n=[],i=0;i<2*e;i++)n[i]=0;for(i=0;i<this.g.length;i++)for(var s=0;s<t.g.length;s++){var c=this.i(i)>>>16,f=65535&this.i(i),g=t.i(s)>>>16,m=65535&t.i(s);n[2*i+2*s]+=f*m,p(n,2*i+2*s),n[2*i+2*s+1]+=c*m,p(n,2*i+2*s+1),n[2*i+2*s+1]+=f*g,p(n,2*i+2*s+1),n[2*i+2*s+2]+=c*g,p(n,2*i+2*s+2)}for(i=0;i<e;i++)n[i]=n[2*i+1]<<16|n[2*i];for(i=e;i<2*e;i++)n[i]=0;return new r(n,0)},t.A=function(t){return m(this,t).h},t.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)&t.i(i);return new r(n,this.h&t.h)},t.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)|t.i(i);return new r(n,this.h|t.h)},t.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],i=0;i<e;i++)n[i]=this.i(i)^t.i(i);return new r(n,this.h^t.h)},e.prototype.digest=e.prototype.v,e.prototype.reset=e.prototype.s,e.prototype.update=e.prototype.u,$t=Kt.Md5=e,r.prototype.add=r.prototype.add,r.prototype.multiply=r.prototype.j,r.prototype.modulo=r.prototype.A,r.prototype.compare=r.prototype.l,r.prototype.toNumber=r.prototype.m,r.prototype.toString=r.prototype.toString,r.prototype.getBits=r.prototype.i,r.fromNumber=o,r.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return d(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=o(Math.pow(n,8)),i=a,s=0;s<e.length;s+=8){var c=Math.min(8,e.length-s),u=parseInt(e.substring(s,s+c),n);8>c?(c=o(Math.pow(n,c)),i=i.j(c).add(o(u))):i=(i=i.j(r)).add(o(u))}return i},qt=Kt.Integer=r}).apply(void 0!==zt?zt:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var Ht,Gt,Qt,Wt,Xt,Yt,Jt,Zt,te="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},ee={};(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){return t==Array.prototype||t==Object.prototype||(t[e]=n.value),t},n=function(t){t=["object"==typeof globalThis&&globalThis,t,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof te&&te];for(var e=0;e<t.length;++e){var n=t[e];if(n&&n.Math==Math)return n}throw Error("Cannot find global object")}(this);!function(t,r){if(r)t:{var i=n;t=t.split(".");for(var s=0;s<t.length-1;s++){var o=t[s];if(!(o in i))break t;i=i[o]}(r=r(s=i[t=t[t.length-1]]))!=s&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Array.prototype.values",function(t){return t||function(){return function(t,e){t instanceof String&&(t+="");var n=0,r=!1,i={next:function(){if(!r&&n<t.length){var i=n++;return{value:e(0,t[i]),done:!1}}return r=!0,{done:!0,value:void 0}}};return i[Symbol.iterator]=function(){return i},i}(this,function(t,e){return e})}});var r=r||{},i=this||self;function s(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function o(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}function a(t,e,n){return t.call.apply(t.bind,arguments)}function c(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function u(t,e,n){return(u=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?a:c).apply(null,arguments)}function h(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function l(t,e){function n(){}n.prototype=e.prototype,t.aa=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Qb=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function d(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function f(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(s(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function p(t){return/^[\s\xa0]*$/.test(t)}function g(){var t=i.navigator;return t&&(t=t.userAgent)?t:""}function m(t){return m[" "](t),t}m[" "]=function(){};var y=!(-1==g().indexOf("Gecko")||-1!=g().toLowerCase().indexOf("webkit")&&-1==g().indexOf("Edge")||-1!=g().indexOf("Trident")||-1!=g().indexOf("MSIE")||-1!=g().indexOf("Edge"));function v(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function w(t){const e={};for(const n in t)e[n]=t[n];return e}const b="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function E(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<b.length;e++)n=b[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function T(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function _(t){i.setTimeout(()=>{throw t},0)}function C(){var t=k;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var I=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}(()=>new S,t=>t.reset());class S{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}let A,D=!1,k=new class{constructor(){this.h=this.g=null}add(t,e){const n=I.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},N=()=>{const t=i.Promise.resolve(void 0);A=()=>{t.then(x)}};var x=()=>{for(var t;t=C();){try{t.h.call(t.g)}catch(t){_(t)}var e=I;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}D=!1};function R(){this.s=this.s,this.C=this.C}function O(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}R.prototype.s=!1,R.prototype.ma=function(){this.s||(this.s=!0,this.N())},R.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},O.prototype.h=function(){this.defaultPrevented=!0};var L=function(){if(!i.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};i.addEventListener("test",t,e),i.removeEventListener("test",t,e)}catch(t){}return t}();function M(t,e){if(O.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(y){t:{try{m(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:P[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&M.aa.h.call(this)}}l(M,O);var P={2:"touch",3:"pen",4:"mouse"};M.prototype.h=function(){M.aa.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var V="closure_listenable_"+(1e6*Math.random()|0),F=0;function U(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ha=i,this.key=++F,this.da=this.fa=!1}function B(t){t.da=!0,t.listener=null,t.proxy=null,t.src=null,t.ha=null}function j(t){this.src=t,this.g={},this.h=0}function q(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Array.prototype.indexOf.call(i,e,void 0);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(B(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function $(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.da&&s.listener==e&&s.capture==!!n&&s.ha==r)return i}return-1}j.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=$(t,e,r,i);return-1<o?(e=t[o],n||(e.fa=!1)):((e=new U(e,this.src,s,!!r,i)).fa=n,t.push(e)),e};var z="closure_lm_"+(1e6*Math.random()|0),K={};function H(t,e,n,r,i){if(r&&r.once)return Q(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)H(t,e[s],n,r,i);return null}return n=et(n),t&&t[V]?t.K(e,n,o(r)?!!r.capture:!!r,i):G(t,e,n,!1,r,i)}function G(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var a=o(i)?!!i.capture:!!i,c=Z(t);if(c||(t[z]=c=new j(t)),(n=c.add(e,n,r,a,s)).proxy)return n;if(r=function(){const t=J;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)L||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Y(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Q(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)Q(t,e[s],n,r,i);return null}return n=et(n),t&&t[V]?t.L(e,n,o(r)?!!r.capture:!!r,i):G(t,e,n,!0,r,i)}function W(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)W(t,e[s],n,r,i);else r=o(r)?!!r.capture:!!r,n=et(n),t&&t[V]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=$(s=t.g[e],n,r,i))&&(B(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Z(t))&&(e=t.g[e.toString()],t=-1,e&&(t=$(e,n,r,i)),(n=-1<t?e[t]:null)&&X(n))}function X(t){if("number"!=typeof t&&t&&!t.da){var e=t.src;if(e&&e[V])q(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Y(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Z(e))?(q(n,t),0==n.h&&(n.src=null,e[z]=null)):B(t)}}}function Y(t){return t in K?K[t]:K[t]="on"+t}function J(t,e){if(t.da)t=!0;else{e=new M(e,this);var n=t.listener,r=t.ha||t.src;t.fa&&X(t),t=n.call(r,e)}return t}function Z(t){return(t=t[z])instanceof j?t:null}var tt="__closure_events_fn_"+(1e9*Math.random()>>>0);function et(t){return"function"==typeof t?t:(t[tt]||(t[tt]=function(e){return t.handleEvent(e)}),t[tt])}function nt(){R.call(this),this.i=new j(this),this.M=this,this.F=null}function rt(t,e){var n,r=t.F;if(r)for(n=[];r;r=r.F)n.push(r);if(t=t.M,r=e.type||e,"string"==typeof e)e=new O(e,t);else if(e instanceof O)e.target=e.target||t;else{var i=e;E(e=new O(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=it(o,r,!0,e)&&i}if(i=it(o=e.g=t,r,!0,e)&&i,i=it(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=it(o=e.g=n[s],r,!1,e)&&i}function it(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.da&&o.capture==n){var a=o.listener,c=o.ha||o.src;o.fa&&q(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}function st(t,e,n){if("function"==typeof t)n&&(t=u(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=u(t.handleEvent,t)}return 2147483647<Number(e)?-1:i.setTimeout(t,e||0)}function ot(t){t.g=st(()=>{t.g=null,t.i&&(t.i=!1,ot(t))},t.l);const e=t.h;t.h=null,t.m.apply(null,e)}l(nt,R),nt.prototype[V]=!0,nt.prototype.removeEventListener=function(t,e,n,r){W(this,t,e,n,r)},nt.prototype.N=function(){if(nt.aa.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)B(n[r]);delete e.g[t],e.h--}}this.F=null},nt.prototype.K=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},nt.prototype.L=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};class at extends R{constructor(t,e){super(),this.m=t,this.l=e,this.h=null,this.i=!1,this.g=null}j(t){this.h=arguments,this.g?this.i=!0:ot(this)}N(){super.N(),this.g&&(i.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function ct(t){R.call(this),this.h=t,this.g={}}l(ct,R);var ut=[];function ht(t){v(t.g,function(t,e){this.g.hasOwnProperty(e)&&X(t)},t),t.g={}}ct.prototype.N=function(){ct.aa.N.call(this),ht(this)},ct.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var lt=i.JSON.stringify,dt=i.JSON.parse,ft=class{stringify(t){return i.JSON.stringify(t,void 0)}parse(t){return i.JSON.parse(t,void 0)}};function pt(){}function gt(t){return t.h||(t.h=t.i())}function mt(){}pt.prototype.h=null;var yt={OPEN:"a",kb:"b",Ja:"c",wb:"d"};function vt(){O.call(this,"d")}function wt(){O.call(this,"c")}l(vt,O),l(wt,O);var bt={},Et=null;function Tt(){return Et=Et||new nt}function _t(t){O.call(this,bt.La,t)}function Ct(t){const e=Tt();rt(e,new _t(e))}function It(t,e){O.call(this,bt.STAT_EVENT,t),this.stat=e}function St(t){const e=Tt();rt(e,new It(e,t))}function At(t,e){O.call(this,bt.Ma,t),this.size=e}function Dt(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return i.setTimeout(function(){t()},e)}function kt(){this.g=!0}function Nt(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return lt(n)}catch(t){return e}}(t,n)+(r?" "+r:"")})}bt.La="serverreachability",l(_t,O),bt.STAT_EVENT="statevent",l(It,O),bt.Ma="timingevent",l(At,O),kt.prototype.xa=function(){this.g=!1},kt.prototype.info=function(){};var xt,Rt={NO_ERROR:0,gb:1,tb:2,sb:3,nb:4,rb:5,ub:6,Ia:7,TIMEOUT:8,xb:9},Ot={lb:"complete",Hb:"success",Ja:"error",Ia:"abort",zb:"ready",Ab:"readystatechange",TIMEOUT:"timeout",vb:"incrementaldata",yb:"progress",ob:"downloadprogress",Pb:"uploadprogress"};function Lt(){}function Mt(t,e,n,r){this.j=t,this.i=e,this.l=n,this.R=r||1,this.U=new ct(this),this.I=45e3,this.H=null,this.o=!1,this.m=this.A=this.v=this.L=this.F=this.S=this.B=null,this.D=[],this.g=null,this.C=0,this.s=this.u=null,this.X=-1,this.J=!1,this.O=0,this.M=null,this.W=this.K=this.T=this.P=!1,this.h=new Pt}function Pt(){this.i=null,this.g="",this.h=!1}l(Lt,pt),Lt.prototype.g=function(){return new XMLHttpRequest},Lt.prototype.i=function(){return{}},xt=new Lt;var Vt={},Ft={};function Ut(t,e,n){t.L=1,t.v=Ee(me(e)),t.m=n,t.P=!0,Bt(t,null)}function Bt(t,e){t.F=Date.now(),$t(t),t.A=me(t.v);var n=t.A,r=t.R;Array.isArray(r)||(r=[String(r)]),Me(n.i,"t",r),t.C=0,n=t.j.J,t.h=new Pt,t.g=_n(t.j,n?e:null,!t.m),0<t.O&&(t.M=new at(u(t.Y,t,t.g),t.O)),e=t.U,n=t.g,r=t.ca;var i="readystatechange";Array.isArray(i)||(i&&(ut[0]=i.toString()),i=ut);for(var s=0;s<i.length;s++){var o=H(n,i[s],r||e.handleEvent,!1,e.h||e);if(!o)break;e.g[o.key]=o}e=t.H?w(t.H):{},t.m?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.m,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),Ct(),function(t,e,n,r,i,s){t.info(function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o})}(t.i,t.u,t.A,t.l,t.R,t.m)}function jt(t){return!!t.g&&"GET"==t.u&&2!=t.L&&t.j.Ca}function qt(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Ft:(n=Number(e.substring(n,r)),isNaN(n)?Vt:(r+=1)+n>e.length?Ft:(e=e.slice(r,r+n),t.C=r+n,e))}function $t(t){t.S=Date.now()+t.I,zt(t,t.I)}function zt(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Dt(u(t.ba,t),e)}function Kt(t){t.B&&(i.clearTimeout(t.B),t.B=null)}function ne(t){0==t.j.G||t.J||vn(t.j,t)}function re(t){Kt(t);var e=t.M;e&&"function"==typeof e.ma&&e.ma(),t.M=null,ht(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.ma())}function ie(t,e){try{var n=t.j;if(0!=n.G&&(n.g==t||ue(n.h,t)))if(!t.K&&ue(n.h,t)&&3==n.G){try{var r=n.Da.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;yn(n),an(n)}pn(n),St(18)}}else n.za=i[1],0<n.za-n.T&&37500>i[2]&&n.F&&0==n.v&&!n.C&&(n.C=Dt(u(n.Za,n),6e3));if(1>=ce(n.h)&&n.ca){try{n.ca()}catch(t){}n.ca=void 0}}else bn(n,11)}else if((t.K||n.g==t)&&yn(n),!p(e))for(i=n.Da.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.T=u[0],u=u[1],2==n.G)if("c"==u[0]){n.K=u[1],n.ia=u[2];const e=u[3];null!=e&&(n.la=e,n.j.info("VER="+n.la));const i=u[4];null!=i&&(n.Aa=i,n.j.info("SVER="+n.Aa));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.h;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(he(s,s.h),s.h=null))}if(r.D){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.ya=t,be(r.I,r.D,t))}}n.G=3,n.l&&n.l.ua(),n.ba&&(n.R=Date.now()-t.F,n.j.info("Handshake RTT: "+n.R+"ms"));var o=t;if((r=n).qa=Tn(r,r.J?r.ia:null,r.W),o.K){le(r.h,o);var a=o,c=r.L;c&&(a.I=c),a.B&&(Kt(a),$t(a)),r.g=o}else fn(r);0<n.i.length&&un(n)}else"stop"!=u[0]&&"close"!=u[0]||bn(n,7);else 3==n.G&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?bn(n,7):on(n):"noop"!=u[0]&&n.l&&n.l.ta(u),n.v=0)}Ct()}catch(t){}}Mt.prototype.ca=function(t){t=t.target;const e=this.M;e&&3==en(t)?e.j():this.Y(t)},Mt.prototype.Y=function(t){try{if(t==this.g)t:{const d=en(this.g);var e=this.g.Ba();if(this.g.Z(),!(3>d)&&(3!=d||this.g&&(this.h.h||this.g.oa()||nn(this.g)))){this.J||4!=d||7==e||Ct(),Kt(this);var n=this.g.Z();this.X=n;e:if(jt(this)){var r=nn(this.g);t="";var s=r.length,o=4==en(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){re(this),ne(this);var a="";break e}this.h.i=new i.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:!(o&&e==s-1)});r.length=0,this.h.g+=t,this.C=0,a=this.h.g}else a=this.g.oa();if(this.o=200==n,function(t,e,n,r,i,s,o){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o})}(this.i,this.u,this.A,this.l,this.R,d,n),this.o){if(this.T&&!this.K){e:{if(this.g){var c,u=this.g;if((c=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!p(c)){var h=c;break e}}h=null}if(!(n=h)){this.o=!1,this.s=3,St(12),re(this),ne(this);break t}Nt(this.i,this.l,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,ie(this,n)}if(this.P){let t;for(n=!0;!this.J&&this.C<a.length;){if(t=qt(this,a),t==Ft){4==d&&(this.s=4,St(14),n=!1),Nt(this.i,this.l,null,"[Incomplete Response]");break}if(t==Vt){this.s=4,St(15),Nt(this.i,this.l,a,"[Invalid Chunk]"),n=!1;break}Nt(this.i,this.l,t,null),ie(this,t)}if(jt(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=d||0!=a.length||this.h.h||(this.s=1,St(16),n=!1),this.o=this.o&&n,n){if(0<a.length&&!this.W){this.W=!0;var l=this.j;l.g==this&&l.ba&&!l.M&&(l.j.info("Great, no buffering proxy detected. Bytes received: "+a.length),gn(l),l.M=!0,St(11))}}else Nt(this.i,this.l,a,"[Invalid Chunked Response]"),re(this),ne(this)}else Nt(this.i,this.l,a,null),ie(this,a);4==d&&re(this),this.o&&!this.J&&(4==d?vn(this.j,this):(this.o=!1,$t(this)))}else(function(t){const e={};t=(t.g&&2<=en(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(p(t[r]))continue;var n=T(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,function(t){return t.join(", ")})})(this.g),400==n&&0<a.indexOf("Unknown SID")?(this.s=3,St(12)):(this.s=0,St(13)),re(this),ne(this)}}}catch(t){}},Mt.prototype.cancel=function(){this.J=!0,re(this)},Mt.prototype.ba=function(){this.B=null;const t=Date.now();0<=t-this.S?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.i,this.A),2!=this.L&&(Ct(),St(17)),re(this),this.s=2,ne(this)):zt(this,this.S-t)};var se=class{constructor(t,e){this.g=t,this.map=e}};function oe(t){this.l=t||10,t=i.PerformanceNavigationTiming?0<(t=i.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(i.chrome&&i.chrome.loadTimes&&i.chrome.loadTimes()&&i.chrome.loadTimes().wasFetchedViaSpdy),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}function ae(t){return!!t.h||!!t.g&&t.g.size>=t.j}function ce(t){return t.h?1:t.g?t.g.size:0}function ue(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function he(t,e){t.g?t.g.add(e):t.h=e}function le(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function de(t){if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.D);return e}return d(t.i)}function fe(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(s(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.na&&"function"==typeof t.na)return t.na();if(!t.V||"function"!=typeof t.V){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(s(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.V&&"function"==typeof t.V)return t.V();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(s(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}oe.prototype.cancel=function(){if(this.i=de(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var pe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function ge(t){if(this.g=this.o=this.j="",this.s=null,this.m=this.l="",this.h=!1,t instanceof ge){this.h=t.h,ye(this,t.j),this.o=t.o,this.g=t.g,ve(this,t.s),this.l=t.l;var e=t.i,n=new xe;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),we(this,n),this.m=t.m}else t&&(e=String(t).match(pe))?(this.h=!1,ye(this,e[1]||"",!0),this.o=Te(e[2]||""),this.g=Te(e[3]||"",!0),ve(this,e[4]),this.l=Te(e[5]||"",!0),we(this,e[6]||"",!0),this.m=Te(e[7]||"")):(this.h=!1,this.i=new xe(null,this.h))}function me(t){return new ge(t)}function ye(t,e,n){t.j=n?Te(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function ve(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.s=e}else t.s=null}function we(t,e,n){e instanceof xe?(t.i=e,function(t,e){e&&!t.j&&(Re(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Oe(this,e),Me(this,n,t))},t)),t.j=e}(t.i,t.h)):(n||(e=_e(e,ke)),t.i=new xe(e,t.h))}function be(t,e,n){t.i.set(e,n)}function Ee(t){return be(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function Te(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function _e(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,Ce),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Ce(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}ge.prototype.toString=function(){var t=[],e=this.j;e&&t.push(_e(e,Se,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.o)&&t.push(_e(e,Se,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.s)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(_e(n,"/"==n.charAt(0)?De:Ae,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.m)&&t.push("#",_e(n,Ne)),t.join("")};var Ie,Se=/[#\/\?@]/g,Ae=/[#\?:]/g,De=/[#\?]/g,ke=/[#\?@]/g,Ne=/#/g;function xe(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Re(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Oe(t,e){Re(t),e=Pe(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Le(t,e){return Re(t),e=Pe(t,e),t.g.has(e)}function Me(t,e,n){Oe(t,e),0<n.length&&(t.i=null,t.g.set(Pe(t,e),d(n)),t.h+=n.length)}function Pe(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}function Ve(t,e,n,r,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),r(n)}catch(t){}}function Fe(){this.g=new ft}function Ue(t,e,n){const r=n||"";try{fe(t,function(t,n){let i=t;o(t)&&(i=lt(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function Be(t){this.l=t.Ub||null,this.j=t.eb||!1}function je(t,e){nt.call(this),this.D=t,this.o=e,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.u=new Headers,this.h=null,this.B="GET",this.A="",this.g=!1,this.v=this.j=this.l=null}function qe(t){t.j.read().then(t.Pa.bind(t)).catch(t.ga.bind(t))}function $e(t){t.readyState=4,t.l=null,t.j=null,t.v=null,ze(t)}function ze(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function Ke(t){let e="";return v(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}function He(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Ke(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):be(t,e,n))}function Ge(t){nt.call(this),this.headers=new Map,this.o=t||null,this.h=!1,this.v=this.g=null,this.D="",this.m=0,this.l="",this.j=this.B=this.u=this.A=!1,this.I=null,this.H="",this.J=!1}(t=xe.prototype).add=function(t,e){Re(this),this.i=null,t=Pe(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},t.forEach=function(t,e){Re(this),this.g.forEach(function(n,r){n.forEach(function(n){t.call(e,n,r,this)},this)},this)},t.na=function(){Re(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},t.V=function(t){Re(this);let e=[];if("string"==typeof t)Le(this,t)&&(e=e.concat(this.g.get(Pe(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},t.set=function(t,e){return Re(this),this.i=null,Le(this,t=Pe(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},t.get=function(t,e){return t&&0<(t=this.V(t)).length?String(t[0]):e},t.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.V(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")},l(Be,pt),Be.prototype.g=function(){return new je(this.l,this.j)},Be.prototype.i=(Ie={},function(){return Ie}),l(je,nt),(t=je.prototype).open=function(t,e){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.B=t,this.A=e,this.readyState=1,ze(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.u,method:this.B,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||i).fetch(new Request(this.A,e)).then(this.Sa.bind(this),this.ga.bind(this))},t.abort=function(){this.response=this.responseText="",this.u=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,$e(this)),this.readyState=0},t.Sa=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,ze(this)),this.g&&(this.readyState=3,ze(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Qa.bind(this),this.ga.bind(this));else if(void 0!==i.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.v=new TextDecoder;qe(this)}else t.text().then(this.Ra.bind(this),this.ga.bind(this))},t.Pa=function(t){if(this.g){if(this.o&&t.value)this.response.push(t.value);else if(!this.o){var e=t.value?t.value:new Uint8Array(0);(e=this.v.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?$e(this):ze(this),3==this.readyState&&qe(this)}},t.Ra=function(t){this.g&&(this.response=this.responseText=t,$e(this))},t.Qa=function(t){this.g&&(this.response=t,$e(this))},t.ga=function(){this.g&&$e(this)},t.setRequestHeader=function(t,e){this.u.append(t,e)},t.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},t.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(je.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}}),l(Ge,nt);var Qe=/^https?$/i,We=["POST","PUT"];function Xe(t,e){t.h=!1,t.g&&(t.j=!0,t.g.abort(),t.j=!1),t.l=e,t.m=5,Ye(t),Ze(t)}function Ye(t){t.A||(t.A=!0,rt(t,"complete"),rt(t,"error"))}function Je(t){if(t.h&&void 0!==r&&(!t.v[1]||4!=en(t)||2!=t.Z()))if(t.u&&4==en(t))st(t.Ea,0,t);else if(rt(t,"readystatechange"),4==en(t)){t.h=!1;try{const r=t.Z();t:switch(r){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var s;if(s=0===r){var o=String(t.D).match(pe)[1]||null;!o&&i.self&&i.self.location&&(o=i.self.location.protocol.slice(0,-1)),s=!Qe.test(o?o.toLowerCase():"")}n=s}if(n)rt(t,"complete"),rt(t,"success");else{t.m=6;try{var a=2<en(t)?t.g.statusText:""}catch(t){a=""}t.l=a+" ["+t.Z()+"]",Ye(t)}}finally{Ze(t)}}}function Ze(t,e){if(t.g){tn(t);const n=t.g,r=t.v[0]?()=>{}:null;t.g=null,t.v=null,e||rt(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function tn(t){t.I&&(i.clearTimeout(t.I),t.I=null)}function en(t){return t.g?t.g.readyState:0}function nn(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.H){case"":case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function rn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function sn(t){this.Aa=0,this.i=[],this.j=new kt,this.ia=this.qa=this.I=this.W=this.g=this.ya=this.D=this.H=this.m=this.S=this.o=null,this.Ya=this.U=0,this.Va=rn("failFast",!1,t),this.F=this.C=this.u=this.s=this.l=null,this.X=!0,this.za=this.T=-1,this.Y=this.v=this.B=0,this.Ta=rn("baseRetryDelayMs",5e3,t),this.cb=rn("retryDelaySeedMs",1e4,t),this.Wa=rn("forwardChannelMaxRetries",2,t),this.wa=rn("forwardChannelRequestTimeoutMs",2e4,t),this.pa=t&&t.xmlHttpFactory||void 0,this.Xa=t&&t.Tb||void 0,this.Ca=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.h=new oe(t&&t.concurrentRequestLimit),this.Da=new Fe,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.Ua=t&&t.Rb||!1,t&&t.xa&&this.j.xa(),t&&t.forceLongPolling&&(this.X=!1),this.ba=!this.P&&this.X&&t&&t.detectBufferingProxy||!1,this.ja=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.ja=t.longPollingTimeout),this.ca=void 0,this.R=0,this.M=!1,this.ka=this.A=null}function on(t){if(cn(t),3==t.G){var e=t.U++,n=me(t.I);if(be(n,"SID",t.K),be(n,"RID",e),be(n,"TYPE","terminate"),ln(t,n),(e=new Mt(t,t.j,e)).L=2,e.v=Ee(me(n)),n=!1,i.navigator&&i.navigator.sendBeacon)try{n=i.navigator.sendBeacon(e.v.toString(),"")}catch(t){}!n&&i.Image&&((new Image).src=e.v,n=!0),n||(e.g=_n(e.j,null),e.g.ea(e.v)),e.F=Date.now(),$t(e)}En(t)}function an(t){t.g&&(gn(t),t.g.cancel(),t.g=null)}function cn(t){an(t),t.u&&(i.clearTimeout(t.u),t.u=null),yn(t),t.h.cancel(),t.s&&("number"==typeof t.s&&i.clearTimeout(t.s),t.s=null)}function un(t){if(!ae(t.h)&&!t.s){t.s=!0;var e=t.Ga;A||N(),D||(A(),D=!0),k.add(e,t),t.B=0}}function hn(t,e){var n;n=e?e.l:t.U++;const r=me(t.I);be(r,"SID",t.K),be(r,"RID",n),be(r,"AID",t.T),ln(t,r),t.m&&t.o&&He(r,t.m,t.o),n=new Mt(t,t.j,n,t.B+1),null===t.m&&(n.H=t.o),e&&(t.i=e.D.concat(t.i)),e=dn(t,n,1e3),n.I=Math.round(.5*t.wa)+Math.round(.5*t.wa*Math.random()),he(t.h,n),Ut(n,r,e)}function ln(t,e){t.H&&v(t.H,function(t,n){be(e,n,t)}),t.l&&fe({},function(t,n){be(e,n,t)})}function dn(t,e,n){n=Math.min(t.i.length,n);var r=t.l?u(t.l.Na,t.l,t):null;t:{var i=t.i;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{Ue(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.i.splice(0,n),e.D=t,r}function fn(t){if(!t.g&&!t.u){t.Y=1;var e=t.Fa;A||N(),D||(A(),D=!0),k.add(e,t),t.v=0}}function pn(t){return!(t.g||t.u||3<=t.v||(t.Y++,t.u=Dt(u(t.Fa,t),wn(t,t.v)),t.v++,0))}function gn(t){null!=t.A&&(i.clearTimeout(t.A),t.A=null)}function mn(t){t.g=new Mt(t,t.j,"rpc",t.Y),null===t.m&&(t.g.H=t.o),t.g.O=0;var e=me(t.qa);be(e,"RID","rpc"),be(e,"SID",t.K),be(e,"AID",t.T),be(e,"CI",t.F?"0":"1"),!t.F&&t.ja&&be(e,"TO",t.ja),be(e,"TYPE","xmlhttp"),ln(t,e),t.m&&t.o&&He(e,t.m,t.o),t.L&&(t.g.I=t.L);var n=t.g;t=t.ia,n.L=1,n.v=Ee(me(e)),n.m=null,n.P=!0,Bt(n,t)}function yn(t){null!=t.C&&(i.clearTimeout(t.C),t.C=null)}function vn(t,e){var n=null;if(t.g==e){yn(t),gn(t),t.g=null;var r=2}else{if(!ue(t.h,e))return;n=e.D,le(t.h,e),r=1}if(0!=t.G)if(e.o)if(1==r){n=e.m?e.m.length:0,e=Date.now()-e.F;var i=t.B;rt(r=Tt(),new At(r,n)),un(t)}else fn(t);else if(3==(i=e.s)||0==i&&0<e.X||!(1==r&&function(t,e){return!(ce(t.h)>=t.h.j-(t.s?1:0)||(t.s?(t.i=e.D.concat(t.i),0):1==t.G||2==t.G||t.B>=(t.Va?0:t.Wa)||(t.s=Dt(u(t.Ga,t,e),wn(t,t.B)),t.B++,0)))}(t,e)||2==r&&pn(t)))switch(n&&0<n.length&&(e=t.h,e.i=e.i.concat(n)),i){case 1:bn(t,5);break;case 4:bn(t,10);break;case 3:bn(t,6);break;default:bn(t,2)}}function wn(t,e){let n=t.Ta+Math.floor(Math.random()*t.cb);return t.isActive()||(n*=2),n*e}function bn(t,e){if(t.j.info("Error code "+e),2==e){var n=u(t.fb,t),r=t.Xa;const e=!r;r=new ge(r||"//www.google.com/images/cleardot.gif"),i.location&&"http"==i.location.protocol||ye(r,"https"),Ee(r),e?function(t,e){const n=new kt;if(i.Image){const r=new Image;r.onload=h(Ve,n,"TestLoadImage: loaded",!0,e,r),r.onerror=h(Ve,n,"TestLoadImage: error",!1,e,r),r.onabort=h(Ve,n,"TestLoadImage: abort",!1,e,r),r.ontimeout=h(Ve,n,"TestLoadImage: timeout",!1,e,r),i.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(r.toString(),n):function(t,e){new kt;const n=new AbortController,r=setTimeout(()=>{n.abort(),Ve(0,0,!1,e)},1e4);fetch(t,{signal:n.signal}).then(t=>{clearTimeout(r),t.ok?Ve(0,0,!0,e):Ve(0,0,!1,e)}).catch(()=>{clearTimeout(r),Ve(0,0,!1,e)})}(r.toString(),n)}else St(2);t.G=0,t.l&&t.l.sa(e),En(t),cn(t)}function En(t){if(t.G=0,t.ka=[],t.l){const e=de(t.h);0==e.length&&0==t.i.length||(f(t.ka,e),f(t.ka,t.i),t.h.i.length=0,d(t.i),t.i.length=0),t.l.ra()}}function Tn(t,e,n){var r=n instanceof ge?me(n):new ge(n);if(""!=r.g)e&&(r.g=e+"."+r.g),ve(r,r.s);else{var s=i.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var o=new ge(null);r&&ye(o,r),e&&(o.g=e),s&&ve(o,s),n&&(o.l=n),r=o}return n=t.D,e=t.ya,n&&e&&be(r,n,e),be(r,"VER",t.la),ln(t,r),r}function _n(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ca&&!t.pa?new Ge(new Be({eb:n})):new Ge(t.pa)).Ha(t.J),e}function Cn(){}function In(){}function Sn(t,e){nt.call(this),this.g=new sn(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.o=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.va&&(t?t["X-WebChannel-Client-Profile"]=e.va:t={"X-WebChannel-Client-Profile":e.va}),this.g.S=t,(t=e&&e.Sb)&&!p(t)&&(this.g.m=t),this.v=e&&e.supportsCrossDomainXhr||!1,this.u=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!p(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new kn(this)}function An(t){vt.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Dn(){wt.call(this),this.status=1}function kn(t){this.g=t}(t=Ge.prototype).Ha=function(t){this.J=t},t.ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.l="",this.m=0,this.A=!1,this.h=!0,this.g=this.o?this.o.g():xt.g(),this.v=this.o?gt(this.o):gt(xt),this.g.onreadystatechange=u(this.Ea,this);try{this.B=!0,this.g.open(e,String(t),!0),this.B=!1}catch(t){return void Xe(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find(t=>"content-type"==t.toLowerCase()),s=i.FormData&&t instanceof i.FormData,!(0<=Array.prototype.indexOf.call(We,e,void 0))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.H&&(this.g.responseType=this.H),"withCredentials"in this.g&&this.g.withCredentials!==this.J&&(this.g.withCredentials=this.J);try{tn(this),this.u=!0,this.g.send(t),this.u=!1}catch(t){Xe(this,t)}},t.abort=function(t){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.m=t||7,rt(this,"complete"),rt(this,"abort"),Ze(this))},t.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Ze(this,!0)),Ge.aa.N.call(this)},t.Ea=function(){this.s||(this.B||this.u||this.j?Je(this):this.bb())},t.bb=function(){Je(this)},t.isActive=function(){return!!this.g},t.Z=function(){try{return 2<en(this)?this.g.status:-1}catch(t){return-1}},t.oa=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},t.Oa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),dt(e)}},t.Ba=function(){return this.m},t.Ka=function(){return"string"==typeof this.l?this.l:String(this.l)},(t=sn.prototype).la=8,t.G=1,t.connect=function(t,e,n,r){St(0),this.W=t,this.H=e||{},n&&void 0!==r&&(this.H.OSID=n,this.H.OAID=r),this.F=this.X,this.I=Tn(this,null,this.W),un(this)},t.Ga=function(t){if(this.s)if(this.s=null,1==this.G){if(!t){this.U=Math.floor(1e5*Math.random()),t=this.U++;const i=new Mt(this,this.j,t);let s=this.o;if(this.S&&(s?(s=w(s),E(s,this.S)):s=this.S),null!==this.m||this.O||(i.H=s,s=null),this.P)t:{for(var e=0,n=0;n<this.i.length;n++){var r=this.i[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.i.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=dn(this,i,e),be(n=me(this.I),"RID",t),be(n,"CVER",22),this.D&&be(n,"X-HTTP-Session-Id",this.D),ln(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Ke(s)))+"&"+e:this.m&&He(n,this.m,s)),he(this.h,i),this.Ua&&be(n,"TYPE","init"),this.P?(be(n,"$req",e),be(n,"SID","null"),i.T=!0,Ut(i,n,null)):Ut(i,n,e),this.G=2}}else 3==this.G&&(t?hn(this,t):0==this.i.length||ae(this.h)||hn(this))},t.Fa=function(){if(this.u=null,mn(this),this.ba&&!(this.M||null==this.g||0>=this.R)){var t=2*this.R;this.j.info("BP detection timer enabled: "+t),this.A=Dt(u(this.ab,this),t)}},t.ab=function(){this.A&&(this.A=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.M=!0,St(10),an(this),mn(this))},t.Za=function(){null!=this.C&&(this.C=null,an(this),pn(this),St(19))},t.fb=function(t){t?(this.j.info("Successfully pinged google.com"),St(2)):(this.j.info("Failed to ping google.com"),St(1))},t.isActive=function(){return!!this.l&&this.l.isActive(this)},(t=Cn.prototype).ua=function(){},t.ta=function(){},t.sa=function(){},t.ra=function(){},t.isActive=function(){return!0},t.Na=function(){},In.prototype.g=function(t,e){return new Sn(t,e)},l(Sn,nt),Sn.prototype.m=function(){this.g.l=this.j,this.v&&(this.g.J=!0),this.g.connect(this.l,this.h||void 0)},Sn.prototype.close=function(){on(this.g)},Sn.prototype.o=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.u&&((n={}).__data__=lt(t),t=n);e.i.push(new se(e.Ya++,t)),3==e.G&&un(e)},Sn.prototype.N=function(){this.g.l=null,delete this.j,on(this.g),delete this.g,Sn.aa.N.call(this)},l(An,vt),l(Dn,wt),l(kn,Cn),kn.prototype.ua=function(){rt(this.g,"a")},kn.prototype.ta=function(t){rt(this.g,new An(t))},kn.prototype.sa=function(t){rt(this.g,new Dn)},kn.prototype.ra=function(){rt(this.g,"b")},In.prototype.createWebChannel=In.prototype.g,Sn.prototype.send=Sn.prototype.o,Sn.prototype.open=Sn.prototype.m,Sn.prototype.close=Sn.prototype.close,Zt=ee.createWebChannelTransport=function(){return new In},Jt=ee.getStatEventTarget=function(){return Tt()},Yt=ee.Event=bt,Xt=ee.Stat={mb:0,pb:1,qb:2,Jb:3,Ob:4,Lb:5,Mb:6,Kb:7,Ib:8,Nb:9,PROXY:10,NOPROXY:11,Gb:12,Cb:13,Db:14,Bb:15,Eb:16,Fb:17,ib:18,hb:19,jb:20},Rt.NO_ERROR=0,Rt.TIMEOUT=8,Rt.HTTP_ERROR=6,Wt=ee.ErrorCode=Rt,Ot.COMPLETE="complete",Qt=ee.EventType=Ot,mt.EventType=yt,yt.OPEN="a",yt.CLOSE="b",yt.ERROR="c",yt.MESSAGE="d",nt.prototype.listen=nt.prototype.K,Gt=ee.WebChannel=mt,ee.FetchXmlHttpFactory=Be,Ge.prototype.listenOnce=Ge.prototype.L,Ge.prototype.getLastError=Ge.prototype.Ka,Ge.prototype.getLastErrorCode=Ge.prototype.Ba,Ge.prototype.getStatus=Ge.prototype.Z,Ge.prototype.getResponseJson=Ge.prototype.Oa,Ge.prototype.getResponseText=Ge.prototype.oa,Ge.prototype.send=Ge.prototype.ea,Ge.prototype.setWithCredentials=Ge.prototype.Ha,Ht=ee.XhrIo=Ge}).apply(void 0!==te?te:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});const ne="@firebase/firestore",re="4.7.17";class ie{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}ie.UNAUTHENTICATED=new ie(null),ie.GOOGLE_CREDENTIALS=new ie("google-credentials-uid"),ie.FIRST_PARTY=new ie("first-party-uid"),ie.MOCK_USER=new ie("mock-user");let se="11.9.0";const oe=new k("@firebase/firestore");function ae(){return oe.logLevel}function ce(t,...e){if(oe.logLevel<=C.DEBUG){const n=e.map(le);oe.debug(`Firestore (${se}): ${t}`,...n)}}function ue(t,...e){if(oe.logLevel<=C.ERROR){const n=e.map(le);oe.error(`Firestore (${se}): ${t}`,...n)}}function he(t,...e){if(oe.logLevel<=C.WARN){const n=e.map(le);oe.warn(`Firestore (${se}): ${t}`,...n)}}function le(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function de(t,e,n){let r="Unexpected state";"string"==typeof e?r=e:n=e,fe(t,r,n)}function fe(t,e,n){let r=`FIRESTORE (${se}) INTERNAL ASSERTION FAILED: ${e} (ID: ${t.toString(16)})`;if(void 0!==n)try{r+=" CONTEXT: "+JSON.stringify(n)}catch(t){r+=" CONTEXT: "+n}throw ue(r),new Error(r)}function pe(t,e,n,r){let i="Unexpected state";"string"==typeof n?i=n:r=n,t||fe(e,i,r)}function ge(t,e){return t}const me={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class ye extends f{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class ve{constructor(){this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}}class we{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class be{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable(()=>e(ie.UNAUTHENTICATED))}shutdown(){}}class Ee{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable(()=>e(this.token.user))}shutdown(){this.changeListener=null}}class Te{constructor(t){this.t=t,this.currentUser=ie.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){pe(void 0===this.o,42304);let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new ve;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new ve,t.enqueueRetryable(()=>r(this.currentUser))};const s=()=>{const e=i;t.enqueueRetryable(async()=>{await e.promise,await r(this.currentUser)})},o=t=>{ce("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(t=>o(t)),setTimeout(()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(ce("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new ve)}},0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then(e=>this.i!==t?(ce("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(pe("string"==typeof e.accessToken,31837,{l:e}),new we(e.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return pe(null===t||"string"==typeof t,2055,{h:t}),new ie(t)}}class _e{constructor(t,e,n){this.P=t,this.T=e,this.I=n,this.type="FirstParty",this.user=ie.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Ce{constructor(t,e,n){this.P=t,this.T=e,this.I=n}getToken(){return Promise.resolve(new _e(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable(()=>e(ie.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ie{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Se{constructor(t,e){var n;this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,null!=(n=t)&&void 0!==n.settings&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){pe(void 0===this.o,3512);const n=t=>{null!=t.error&&ce("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.m;return this.m=t.token,ce("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable(()=>n(e))};const r=t=>{ce("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(t=>r(t)),setTimeout(()=>{if(!this.appCheck){const t=this.V.getImmediate({optional:!0});t?r(t):ce("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ie(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then(t=>t?(pe("string"==typeof t.token,44558,{tokenResult:t}),this.m=t.token,new Ie(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function Ae(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}function De(){return new TextEncoder}class ke{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=Ae(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function Ne(t,e){return t<e?-1:t>e?1:0}function xe(t,e){let n=0;for(;n<t.length&&n<e.length;){const r=t.codePointAt(n),i=e.codePointAt(n);if(r!==i){if(r<128&&i<128)return Ne(r,i);{const s=De(),o=Oe(s.encode(Re(t,n)),s.encode(Re(e,n)));return 0!==o?o:Ne(r,i)}}n+=r>65535?2:1}return Ne(t.length,e.length)}function Re(t,e){return t.codePointAt(e)>65535?t.substring(e,e+2):t.substring(e,e+1)}function Oe(t,e){for(let n=0;n<t.length&&n<e.length;++n)if(t[n]!==e[n])return Ne(t[n],e[n]);return Ne(t.length,e.length)}function Le(t,e,n){return t.length===e.length&&t.every((t,r)=>n(t,e[r]))}const Me=-62135596800,Pe=1e6;class Ve{static now(){return Ve.fromMillis(Date.now())}static fromDate(t){return Ve.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor((t-1e3*e)*Pe);return new Ve(e,n)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new ye(me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new ye(me.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Me)throw new ye(me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new ye(me.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Pe}_compareTo(t){return this.seconds===t.seconds?Ne(this.nanoseconds,t.nanoseconds):Ne(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds-Me;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class Fe{static fromTimestamp(t){return new Fe(t)}static min(){return new Fe(new Ve(0,0))}static max(){return new Fe(new Ve(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ue="__name__";class Be{constructor(t,e,n){void 0===e?e=0:e>t.length&&de(637,{offset:e,range:t.length}),void 0===n?n=t.length-e:n>t.length-e&&de(1746,{length:n,range:t.length-e}),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===Be.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof Be?t.forEach(t=>{e.push(t)}):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=Be.compareSegments(t.get(r),e.get(r));if(0!==n)return n}return Ne(t.length,e.length)}static compareSegments(t,e){const n=Be.isNumericId(t),r=Be.isNumericId(e);return n&&!r?-1:!n&&r?1:n&&r?Be.extractNumericId(t).compare(Be.extractNumericId(e)):xe(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return qt.fromString(t.substring(4,t.length-2))}}class je extends Be{construct(t,e,n){return new je(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new ye(me.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter(t=>t.length>0))}return new je(e)}static emptyPath(){return new je([])}}const qe=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $e extends Be{construct(t,e,n){return new $e(t,e,n)}static isValidIdentifier(t){return qe.test(t)}canonicalString(){return this.toArray().map(t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$e.isValidIdentifier(t)||(t="`"+t+"`"),t)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Ue}static keyField(){return new $e([Ue])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new ye(me.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new ye(me.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new ye(me.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new ye(me.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new $e(e)}static emptyPath(){return new $e([])}}class ze{constructor(t){this.path=t}static fromPath(t){return new ze(je.fromString(t))}static fromName(t){return new ze(je.fromString(t).popFirst(5))}static empty(){return new ze(je.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===je.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return je.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new ze(new je(t.slice()))}}function Ke(t){return new He(t.readTime,t.key,-1)}class He{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new He(Fe.min(),ze.empty(),-1)}static max(){return new He(Fe.max(),ze.empty(),-1)}}function Ge(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=ze.comparator(t.documentKey,e.documentKey),0!==n?n:Ne(t.largestBatchId,e.largestBatchId))}class Qe{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(t=>t())}}async function We(t){if(t.code!==me.FAILED_PRECONDITION||"The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab."!==t.message)throw t;ce("LocalStore","Unexpectedly lost primary lease")}class Xe{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&de(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new Xe((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}})}toPromise(){return new Promise((t,e)=>{this.next(t,e)})}wrapUserFunction(t){try{const e=t();return e instanceof Xe?e:Xe.resolve(e)}catch(t){return Xe.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction(()=>t(e)):Xe.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction(()=>t(e)):Xe.reject(e)}static resolve(t){return new Xe((e,n)=>{e(t)})}static reject(t){return new Xe((e,n)=>{n(t)})}static waitFor(t){return new Xe((e,n)=>{let r=0,i=0,s=!1;t.forEach(t=>{++r,t.next(()=>{++i,s&&i===r&&e()},t=>n(t))}),s=!0,i===r&&e()})}static or(t){let e=Xe.resolve(!1);for(const n of t)e=e.next(t=>t?Xe.resolve(t):n());return e}static forEach(t,e){const n=[];return t.forEach((t,r)=>{n.push(e.call(this,t,r))}),this.waitFor(n)}static mapArray(t,e){return new Xe((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next(t=>{s[c]=t,++o,o===i&&n(s)},t=>r(t))}})}static doWhile(t,e){return new Xe((n,r)=>{const i=()=>{!0===t()?e().next(()=>{i()},r):n()};i()})}}function Ye(t){return"IndexedDbTransactionError"===t.name}class Je{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.ue(t),this.ce=t=>e.writeSequenceNumber(t))}ue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ce&&this.ce(t),t}}Je.le=-1;function Ze(t){return null==t}function tn(t){return 0===t&&1/t==-1/0}function en(t,e){let n=e;const r=t.length;for(let e=0;e<r;e++){const r=t.charAt(e);switch(r){case"\0":n+="";break;case"":n+="";break;default:n+=r}}return n}function nn(t){return t+""}const rn="owner",sn="mutationQueues",on="mutations",an="documentMutations",cn="remoteDocumentGlobal",un="targets",hn="targetDocuments",ln="targetGlobal",dn="collectionParents",fn="clientMetadata",pn="bundles",gn="namedQueries";function mn(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function yn(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function vn(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class wn{constructor(t,e){this.comparator=t,this.root=e||En.EMPTY}insert(t,e){return new wn(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,En.BLACK,null,null))}remove(t){return new wn(this.comparator,this.root.remove(t,this.comparator).copy(null,null,En.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal((e,n)=>(t(e,n),!1))}toString(){const t=[];return this.inorderTraversal((e,n)=>(t.push(`${e}:${n}`),!1)),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new bn(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new bn(this.root,t,this.comparator,!1)}getReverseIterator(){return new bn(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new bn(this.root,t,this.comparator,!0)}}class bn{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class En{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:En.RED,this.left=null!=r?r:En.EMPTY,this.right=null!=i?i:En.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new En(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return En.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return En.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,En.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,En.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw de(43730,{key:this.key,value:this.value});if(this.right.isRed())throw de(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw de(27949);return t+(this.isRed()?0:1)}}En.EMPTY=null,En.RED=!0,En.BLACK=!1,En.EMPTY=new class{constructor(){this.size=0}get key(){throw de(57766)}get value(){throw de(16141)}get color(){throw de(16727)}get left(){throw de(29726)}get right(){throw de(36894)}copy(t,e,n,r,i){return this}insert(t,e,n){return new En(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Tn{constructor(t){this.comparator=t,this.data=new wn(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal((e,n)=>(t(e),!1))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new _n(this.data.getIterator())}getIteratorFrom(t){return new _n(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach(t=>{e=e.add(t)}),e}isEqual(t){if(!(t instanceof Tn))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach(e=>{t.push(e)}),t}toString(){const t=[];return this.forEach(e=>t.push(e)),"SortedSet("+t.toString()+")"}copy(t){const e=new Tn(this.comparator);return e.data=t,e}}class _n{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class Cn{constructor(t){this.fields=t,t.sort($e.comparator)}static empty(){return new Cn([])}unionWith(t){let e=new Tn($e.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new Cn(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Le(this.fields,t.fields,(t,e)=>t.isEqual(e))}}class In extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Sn{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new In("Invalid base64 string: "+t):t}}(t);return new Sn(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Sn(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Ne(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Sn.EMPTY_BYTE_STRING=new Sn("");const An=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Dn(t){if(pe(!!t,39018),"string"==typeof t){let e=0;const n=An.exec(t);if(pe(!!n,46558,{timestamp:t}),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:kn(t.seconds),nanos:kn(t.nanos)}}function kn(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Nn(t){return"string"==typeof t?Sn.fromBase64String(t):Sn.fromUint8Array(t)}const xn="server_timestamp",Rn="__type__",On="__previous_value__",Ln="__local_write_time__";function Mn(t){var e,n;return(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{})[Rn])||void 0===n?void 0:n.stringValue)===xn}function Pn(t){const e=t.mapValue.fields[On];return Mn(e)?Pn(e):e}function Vn(t){const e=Dn(t.mapValue.fields[Ln].timestampValue);return new Ve(e.seconds,e.nanos)}class Fn{constructor(t,e,n,r,i,s,o,a,c,u){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c,this.isUsingEmulator=u}}const Un="(default)";class Bn{constructor(t,e){this.projectId=t,this.database=e||Un}static empty(){return new Bn("","")}get isDefaultDatabase(){return this.database===Un}isEqual(t){return t instanceof Bn&&t.projectId===this.projectId&&t.database===this.database}}const jn="__type__",qn="__max__",$n={fields:{__type__:{stringValue:qn}}},zn="__vector__",Kn="value";function Hn(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Mn(t)?4:cr(t)?9007199254740991:or(t)?10:11:de(28295,{value:t})}function Gn(t,e){if(t===e)return!0;const n=Hn(t);if(n!==Hn(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Vn(t).isEqual(Vn(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Dn(t.timestampValue),r=Dn(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Nn(t.bytesValue).isEqual(Nn(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return kn(t.geoPointValue.latitude)===kn(e.geoPointValue.latitude)&&kn(t.geoPointValue.longitude)===kn(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return kn(t.integerValue)===kn(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=kn(t.doubleValue),r=kn(e.doubleValue);return n===r?tn(n)===tn(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return Le(t.arrayValue.values||[],e.arrayValue.values||[],Gn);case 10:case 11:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(mn(n)!==mn(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!Gn(n[t],r[t])))return!1;return!0}(t,e);default:return de(52216,{left:t})}}function Qn(t,e){return void 0!==(t.values||[]).find(t=>Gn(t,e))}function Wn(t,e){if(t===e)return 0;const n=Hn(t),r=Hn(e);if(n!==r)return Ne(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ne(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=kn(t.integerValue||t.doubleValue),r=kn(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Xn(t.timestampValue,e.timestampValue);case 4:return Xn(Vn(t),Vn(e));case 5:return xe(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Nn(t),r=Nn(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=Ne(n[t],r[t]);if(0!==e)return e}return Ne(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=Ne(kn(t.latitude),kn(e.latitude));return 0!==n?n:Ne(kn(t.longitude),kn(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return Yn(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n,r,i,s;const o=t.fields||{},a=e.fields||{},c=null===(n=o[Kn])||void 0===n?void 0:n.arrayValue,u=null===(r=a[Kn])||void 0===r?void 0:r.arrayValue,h=Ne((null===(i=null==c?void 0:c.values)||void 0===i?void 0:i.length)||0,(null===(s=null==u?void 0:u.values)||void 0===s?void 0:s.length)||0);return 0!==h?h:Yn(c,u)}(t.mapValue,e.mapValue);case 11:return function(t,e){if(t===$n&&e===$n)return 0;if(t===$n)return 1;if(e===$n)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=xe(r[t],s[t]);if(0!==e)return e;const o=Wn(n[r[t]],i[s[t]]);if(0!==o)return o}return Ne(r.length,s.length)}(t.mapValue,e.mapValue);default:throw de(23264,{Pe:n})}}function Xn(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return Ne(t,e);const n=Dn(t),r=Dn(e),i=Ne(n.seconds,r.seconds);return 0!==i?i:Ne(n.nanos,r.nanos)}function Yn(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=Wn(n[t],r[t]);if(e)return e}return Ne(n.length,r.length)}function Jn(t){return Zn(t)}function Zn(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Dn(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Nn(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return ze.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=Zn(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${Zn(t.fields[i])}`;return n+"}"}(t.mapValue):de(61005,{value:t})}function tr(t){switch(Hn(t)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const e=Pn(t);return e?16+tr(e):16;case 5:return 2*t.stringValue.length;case 6:return Nn(t.bytesValue).approximateByteSize();case 7:return t.referenceValue.length;case 9:return function(t){return(t.values||[]).reduce((t,e)=>t+tr(e),0)}(t.arrayValue);case 10:case 11:return function(t){let e=0;return yn(t.fields,(t,n)=>{e+=t.length+tr(n)}),e}(t.mapValue);default:throw de(13486,{value:t})}}function er(t){return!!t&&"integerValue"in t}function nr(t){return!!t&&"arrayValue"in t}function rr(t){return!!t&&"nullValue"in t}function ir(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function sr(t){return!!t&&"mapValue"in t}function or(t){var e,n;return(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{})[jn])||void 0===n?void 0:n.stringValue)===zn}function ar(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return yn(t.mapValue.fields,(t,n)=>e.mapValue.fields[t]=ar(n)),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=ar(t.arrayValue.values[n]);return e}return Object.assign({},t)}function cr(t){return(((t.mapValue||{}).fields||{}).__type__||{}).stringValue===qn}class ur{constructor(t){this.value=t}static empty(){return new ur({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!sr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=ar(e)}setAll(t){let e=$e.emptyPath(),n={},r=[];t.forEach((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=ar(t):r.push(i.lastSegment())});const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());sr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Gn(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];sr(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){yn(e,(e,n)=>t[e]=n);for(const e of n)delete t[e]}clone(){return new ur(ar(this.value))}}function hr(t){const e=[];return yn(t.fields,(t,n)=>{const r=new $e([t]);if(sr(n)){const t=hr(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)}),new Cn(e)}class lr{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new lr(t,0,Fe.min(),Fe.min(),Fe.min(),ur.empty(),0)}static newFoundDocument(t,e,n,r){return new lr(t,1,e,Fe.min(),n,r,0)}static newNoDocument(t,e){return new lr(t,2,e,Fe.min(),Fe.min(),ur.empty(),0)}static newUnknownDocument(t,e){return new lr(t,3,e,Fe.min(),Fe.min(),ur.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(Fe.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ur.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ur.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=Fe.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof lr&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new lr(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class dr{constructor(t,e){this.position=t,this.inclusive=e}}function fr(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?ze.comparator(ze.fromName(o.referenceValue),n.key):Wn(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function pr(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!Gn(t.position[n],e.position[n]))return!1;return!0}class gr{constructor(t,e="asc"){this.field=t,this.dir=e}}function mr(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class yr{}class vr extends yr{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Ir(t,e,n):"array-contains"===e?new kr(t,n):"in"===e?new Nr(t,n):"not-in"===e?new xr(t,n):"array-contains-any"===e?new Rr(t,n):new vr(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Sr(t,n):new Ar(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&void 0===e.nullValue&&this.matchesComparison(Wn(e,this.value)):null!==e&&Hn(this.value)===Hn(e)&&this.matchesComparison(Wn(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return de(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class wr extends yr{constructor(t,e){super(),this.filters=t,this.op=e,this.Te=null}static create(t,e){return new wr(t,e)}matches(t){return br(this)?void 0===this.filters.find(e=>!e.matches(t)):void 0!==this.filters.find(e=>e.matches(t))}getFlattenedFilters(){return null!==this.Te||(this.Te=this.filters.reduce((t,e)=>t.concat(e.getFlattenedFilters()),[])),this.Te}getFilters(){return Object.assign([],this.filters)}}function br(t){return"and"===t.op}function Er(t){return function(t){for(const e of t.filters)if(e instanceof wr)return!1;return!0}(t)&&br(t)}function Tr(t){if(t instanceof vr)return t.field.canonicalString()+t.op.toString()+Jn(t.value);if(Er(t))return t.filters.map(t=>Tr(t)).join(",");{const e=t.filters.map(t=>Tr(t)).join(",");return`${t.op}(${e})`}}function _r(t,e){return t instanceof vr?function(t,e){return e instanceof vr&&t.op===e.op&&t.field.isEqual(e.field)&&Gn(t.value,e.value)}(t,e):t instanceof wr?function(t,e){return e instanceof wr&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce((t,n,r)=>t&&_r(n,e.filters[r]),!0)}(t,e):void de(19439)}function Cr(t){return t instanceof vr?function(t){return`${t.field.canonicalString()} ${t.op} ${Jn(t.value)}`}(t):t instanceof wr?function(t){return t.op.toString()+" {"+t.getFilters().map(Cr).join(" ,")+"}"}(t):"Filter"}class Ir extends vr{constructor(t,e,n){super(t,e,n),this.key=ze.fromName(n.referenceValue)}matches(t){const e=ze.comparator(t.key,this.key);return this.matchesComparison(e)}}class Sr extends vr{constructor(t,e){super(t,"in",e),this.keys=Dr(0,e)}matches(t){return this.keys.some(e=>e.isEqual(t.key))}}class Ar extends vr{constructor(t,e){super(t,"not-in",e),this.keys=Dr(0,e)}matches(t){return!this.keys.some(e=>e.isEqual(t.key))}}function Dr(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(t=>ze.fromName(t.referenceValue))}class kr extends vr{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return nr(e)&&Qn(e.arrayValue,this.value)}}class Nr extends vr{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&Qn(this.value.arrayValue,e)}}class xr extends vr{constructor(t,e){super(t,"not-in",e)}matches(t){if(Qn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&void 0===e.nullValue&&!Qn(this.value.arrayValue,e)}}class Rr extends vr{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!nr(e)||!e.arrayValue.values)&&e.arrayValue.values.some(t=>Qn(this.value.arrayValue,t))}}class Or{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.Ie=null}}function Lr(t,e=null,n=[],r=[],i=null,s=null,o=null){return new Or(t,e,n,r,i,s,o)}function Mr(t){const e=ge(t);if(null===e.Ie){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(t=>Tr(t)).join(","),t+="|ob:",t+=e.orderBy.map(t=>function(t){return t.field.canonicalString()+t.dir}(t)).join(","),Ze(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(t=>Jn(t)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(t=>Jn(t)).join(",")),e.Ie=t}return e.Ie}function Pr(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!mr(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!_r(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!pr(t.startAt,e.startAt)&&pr(t.endAt,e.endAt)}function Vr(t){return ze.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Fr{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ee=null,this.de=null,this.Ae=null,this.startAt,this.endAt}}function Ur(t){return new Fr(t)}function Br(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function jr(t){const e=ge(t);if(null===e.Ee){e.Ee=[];const t=new Set;for(const n of e.explicitOrderBy)e.Ee.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Tn($e.comparator);return t.filters.forEach(t=>{t.getFlattenedFilters().forEach(t=>{t.isInequality()&&(e=e.add(t.field))})}),e}(e);r.forEach(r=>{t.has(r.canonicalString())||r.isKeyField()||e.Ee.push(new gr(r,n))}),t.has($e.keyField().canonicalString())||e.Ee.push(new gr($e.keyField(),n))}return e.Ee}function qr(t){const e=ge(t);return e.de||(e.de=function(t,e){if("F"===t.limitType)return Lr(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map(t=>{const e="desc"===t.dir?"asc":"desc";return new gr(t.field,e)});const n=t.endAt?new dr(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new dr(t.startAt.position,t.startAt.inclusive):null;return Lr(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,jr(t))),e.de}function $r(t,e,n){return new Fr(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function zr(t,e){return Pr(qr(t),qr(e))&&t.limitType===e.limitType}function Kr(t){return`${Mr(qr(t))}|lt:${t.limitType}`}function Hr(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map(t=>Cr(t)).join(", ")}]`),Ze(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map(t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t)).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(t=>Jn(t)).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(t=>Jn(t)).join(",")),`Target(${e})`}(qr(t))}; limitType=${t.limitType})`}function Gr(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):ze.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of jr(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=fr(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,jr(t),e)||t.endAt&&!function(t,e,n){const r=fr(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,jr(t),e))}(t,e)}function Qr(t){return(e,n)=>{let r=!1;for(const i of jr(t)){const t=Wr(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function Wr(t,e,n){const r=t.field.isKeyField()?ze.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Wn(r,i):de(42886)}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return de(19790,{direction:t.dir})}}class Xr{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){yn(this.inner,(e,n)=>{for(const[e,r]of n)t(e,r)})}isEmpty(){return vn(this.inner)}size(){return this.innerSize}}const Yr=new wn(ze.comparator);function Jr(){return Yr}const Zr=new wn(ze.comparator);function ti(...t){let e=Zr;for(const n of t)e=e.insert(n.key,n);return e}function ei(t){let e=Zr;return t.forEach((t,n)=>e=e.insert(t,n.overlayedDocument)),e}function ni(){return ii()}function ri(){return ii()}function ii(){return new Xr(t=>t.toString(),(t,e)=>t.isEqual(e))}const si=new wn(ze.comparator),oi=new Tn(ze.comparator);function ai(...t){let e=oi;for(const n of t)e=e.add(n);return e}const ci=new Tn(Ne);function ui(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:tn(e)?"-0":e}}function hi(t){return{integerValue:""+t}}function li(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!tn(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?hi(e):ui(t,e)}class di{constructor(){this._=void 0}}function fi(t,e,n){return t instanceof mi?function(t,e){const n={fields:{[Rn]:{stringValue:xn},[Ln]:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Mn(e)&&(e=Pn(e)),e&&(n.fields[On]=e),{mapValue:n}}(n,e):t instanceof yi?vi(t,e):t instanceof wi?bi(t,e):function(t,e){const n=gi(t,e),r=Ti(n)+Ti(t.Re);return er(n)&&er(t.Re)?hi(r):ui(t.serializer,r)}(t,e)}function pi(t,e,n){return t instanceof yi?vi(t,e):t instanceof wi?bi(t,e):n}function gi(t,e){return t instanceof Ei?function(t){return er(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class mi extends di{}class yi extends di{constructor(t){super(),this.elements=t}}function vi(t,e){const n=_i(e);for(const e of t.elements)n.some(t=>Gn(t,e))||n.push(e);return{arrayValue:{values:n}}}class wi extends di{constructor(t){super(),this.elements=t}}function bi(t,e){let n=_i(e);for(const e of t.elements)n=n.filter(t=>!Gn(t,e));return{arrayValue:{values:n}}}class Ei extends di{constructor(t,e){super(),this.serializer=t,this.Re=e}}function Ti(t){return kn(t.integerValue||t.doubleValue)}function _i(t){return nr(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ci{constructor(t,e){this.version=t,this.transformResults=e}}class Ii{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ii}static exists(t){return new Ii(void 0,t)}static updateTime(t){return new Ii(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Si(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ai{}function Di(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Fi(t.key,Ii.none()):new Oi(t.key,t.data,Ii.none());{const n=t.data,r=ur.empty();let i=new Tn($e.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new Li(t.key,r,new Cn(i.toArray()),Ii.none())}}function ki(t,e,n){t instanceof Oi?function(t,e,n){const r=t.value.clone(),i=Pi(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Li?function(t,e,n){if(!Si(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Pi(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Mi(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Ni(t,e,n,r){return t instanceof Oi?function(t,e,n,r){if(!Si(t.precondition,e))return n;const i=t.value.clone(),s=Vi(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof Li?function(t,e,n,r){if(!Si(t.precondition,e))return n;const i=Vi(t.fieldTransforms,r,e),s=e.data;return s.setAll(Mi(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map(t=>t.field))}(t,e,n,r):function(t,e,n){return Si(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function xi(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=gi(r.transform,t||null);null!=i&&(null===n&&(n=ur.empty()),n.set(r.field,i))}return n||null}function Ri(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&Le(t,e,(t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof yi&&e instanceof yi||t instanceof wi&&e instanceof wi?Le(t.elements,e.elements,Gn):t instanceof Ei&&e instanceof Ei?Gn(t.Re,e.Re):t instanceof mi&&e instanceof mi}(t.transform,e.transform)}(t,e))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Oi extends Ai{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class Li extends Ai{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Mi(t){const e=new Map;return t.fieldMask.fields.forEach(n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}}),e}function Pi(t,e,n){const r=new Map;pe(t.length===n.length,32656,{Ve:n.length,me:t.length});for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,pi(o,a,n[i]))}return r}function Vi(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,fi(t,s,e))}return r}class Fi extends Ai{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ui extends Ai{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Bi{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&ki(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Ni(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Ni(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ri();return this.mutations.forEach(r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=Di(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(Fe.min())}),n}keys(){return this.mutations.reduce((t,e)=>t.add(e.key),ai())}isEqual(t){return this.batchId===t.batchId&&Le(this.mutations,t.mutations,(t,e)=>Ri(t,e))&&Le(this.baseMutations,t.baseMutations,(t,e)=>Ri(t,e))}}class ji{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){pe(t.mutations.length===n.length,58842,{fe:t.mutations.length,ge:n.length});let r=si;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new ji(t,e,n,r)}}class qi{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class $i{constructor(t,e){this.count=t,this.unchangedNames=e}}var zi,Ki;function Hi(t){if(void 0===t)return ue("GRPC error has no .code"),me.UNKNOWN;switch(t){case zi.OK:return me.OK;case zi.CANCELLED:return me.CANCELLED;case zi.UNKNOWN:return me.UNKNOWN;case zi.DEADLINE_EXCEEDED:return me.DEADLINE_EXCEEDED;case zi.RESOURCE_EXHAUSTED:return me.RESOURCE_EXHAUSTED;case zi.INTERNAL:return me.INTERNAL;case zi.UNAVAILABLE:return me.UNAVAILABLE;case zi.UNAUTHENTICATED:return me.UNAUTHENTICATED;case zi.INVALID_ARGUMENT:return me.INVALID_ARGUMENT;case zi.NOT_FOUND:return me.NOT_FOUND;case zi.ALREADY_EXISTS:return me.ALREADY_EXISTS;case zi.PERMISSION_DENIED:return me.PERMISSION_DENIED;case zi.FAILED_PRECONDITION:return me.FAILED_PRECONDITION;case zi.ABORTED:return me.ABORTED;case zi.OUT_OF_RANGE:return me.OUT_OF_RANGE;case zi.UNIMPLEMENTED:return me.UNIMPLEMENTED;case zi.DATA_LOSS:return me.DATA_LOSS;default:return de(39323,{code:t})}}(Ki=zi||(zi={}))[Ki.OK=0]="OK",Ki[Ki.CANCELLED=1]="CANCELLED",Ki[Ki.UNKNOWN=2]="UNKNOWN",Ki[Ki.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Ki[Ki.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Ki[Ki.NOT_FOUND=5]="NOT_FOUND",Ki[Ki.ALREADY_EXISTS=6]="ALREADY_EXISTS",Ki[Ki.PERMISSION_DENIED=7]="PERMISSION_DENIED",Ki[Ki.UNAUTHENTICATED=16]="UNAUTHENTICATED",Ki[Ki.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Ki[Ki.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Ki[Ki.ABORTED=10]="ABORTED",Ki[Ki.OUT_OF_RANGE=11]="OUT_OF_RANGE",Ki[Ki.UNIMPLEMENTED=12]="UNIMPLEMENTED",Ki[Ki.INTERNAL=13]="INTERNAL",Ki[Ki.UNAVAILABLE=14]="UNAVAILABLE",Ki[Ki.DATA_LOSS=15]="DATA_LOSS";const Gi=new qt([4294967295,4294967295],0);function Qi(t){const e=De().encode(t),n=new $t;return n.update(e),new Uint8Array(n.digest())}function Wi(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new qt([n,r],0),new qt([i,s],0)]}class Xi{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Yi(`Invalid padding: ${e}`);if(n<0)throw new Yi(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Yi(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Yi(`Invalid padding when bitmap length is 0: ${e}`);this.pe=8*t.length-e,this.ye=qt.fromNumber(this.pe)}we(t,e,n){let r=t.add(e.multiply(qt.fromNumber(n)));return 1===r.compare(Gi)&&(r=new qt([r.getBits(0),r.getBits(1)],0)),r.modulo(this.ye).toNumber()}be(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.pe)return!1;const e=Qi(t),[n,r]=Wi(e);for(let t=0;t<this.hashCount;t++){const e=this.we(n,r,t);if(!this.be(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new Xi(i,r,e);return n.forEach(t=>s.insert(t)),s}insert(t){if(0===this.pe)return;const e=Qi(t),[n,r]=Wi(e);for(let t=0;t<this.hashCount;t++){const e=this.we(n,r,t);this.Se(e)}}Se(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Yi extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Ji{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Zi.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Ji(Fe.min(),r,new wn(Ne),Jr(),ai())}}class Zi{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Zi(n,e,ai(),ai(),ai())}}class ts{constructor(t,e,n,r){this.De=t,this.removedTargetIds=e,this.key=n,this.ve=r}}class es{constructor(t,e){this.targetId=t,this.Ce=e}}class ns{constructor(t,e,n=Sn.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class rs{constructor(){this.Fe=0,this.Me=os(),this.xe=Sn.EMPTY_BYTE_STRING,this.Oe=!1,this.Ne=!0}get current(){return this.Oe}get resumeToken(){return this.xe}get Be(){return 0!==this.Fe}get Le(){return this.Ne}ke(t){t.approximateByteSize()>0&&(this.Ne=!0,this.xe=t)}qe(){let t=ai(),e=ai(),n=ai();return this.Me.forEach((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:de(38017,{changeType:i})}}),new Zi(this.xe,this.Oe,t,e,n)}Qe(){this.Ne=!1,this.Me=os()}$e(t,e){this.Ne=!0,this.Me=this.Me.insert(t,e)}Ue(t){this.Ne=!0,this.Me=this.Me.remove(t)}Ke(){this.Fe+=1}We(){this.Fe-=1,pe(this.Fe>=0,3241,{Fe:this.Fe})}Ge(){this.Ne=!0,this.Oe=!0}}class is{constructor(t){this.ze=t,this.je=new Map,this.He=Jr(),this.Je=ss(),this.Ye=ss(),this.Ze=new wn(Ne)}Xe(t){for(const e of t.De)t.ve&&t.ve.isFoundDocument()?this.et(e,t.ve):this.tt(e,t.key,t.ve);for(const e of t.removedTargetIds)this.tt(e,t.key,t.ve)}nt(t){this.forEachTarget(t,e=>{const n=this.rt(e);switch(t.state){case 0:this.it(e)&&n.ke(t.resumeToken);break;case 1:n.We(),n.Be||n.Qe(),n.ke(t.resumeToken);break;case 2:n.We(),n.Be||this.removeTarget(e);break;case 3:this.it(e)&&(n.Ge(),n.ke(t.resumeToken));break;case 4:this.it(e)&&(this.st(e),n.ke(t.resumeToken));break;default:de(56790,{state:t.state})}})}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.je.forEach((t,n)=>{this.it(n)&&e(n)})}ot(t){const e=t.targetId,n=t.Ce.count,r=this._t(e);if(r){const i=r.target;if(Vr(i))if(0===n){const t=new ze(i.path);this.tt(e,t,lr.newNoDocument(t,Fe.min()))}else pe(1===n,20013,{expectedCount:n});else{const r=this.ut(e);if(r!==n){const n=this.ct(t),i=n?this.lt(n,t,r):1;if(0!==i){this.st(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ze=this.Ze.insert(e,t)}}}}}ct(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Nn(n).toUint8Array()}catch(t){if(t instanceof In)return he("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Xi(s,r,i)}catch(t){return he(t instanceof Yi?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.pe?null:o}lt(t,e,n){return e.Ce.count===n-this.Tt(t,e.targetId)?0:2}Tt(t,e){const n=this.ze.getRemoteKeysForTarget(e);let r=0;return n.forEach(n=>{const i=this.ze.Pt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.tt(e,n,null),r++)}),r}It(t){const e=new Map;this.je.forEach((n,r)=>{const i=this._t(r);if(i){if(n.current&&Vr(i.target)){const e=new ze(i.target.path);this.Et(e).has(r)||this.dt(r,e)||this.tt(r,e,lr.newNoDocument(e,t))}n.Le&&(e.set(r,n.qe()),n.Qe())}});let n=ai();this.Ye.forEach((t,e)=>{let r=!0;e.forEachWhile(t=>{const e=this._t(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)}),r&&(n=n.add(t))}),this.He.forEach((e,n)=>n.setReadTime(t));const r=new Ji(t,e,this.Ze,this.He,n);return this.He=Jr(),this.Je=ss(),this.Ye=ss(),this.Ze=new wn(Ne),r}et(t,e){if(!this.it(t))return;const n=this.dt(t,e.key)?2:0;this.rt(t).$e(e.key,n),this.He=this.He.insert(e.key,e),this.Je=this.Je.insert(e.key,this.Et(e.key).add(t)),this.Ye=this.Ye.insert(e.key,this.At(e.key).add(t))}tt(t,e,n){if(!this.it(t))return;const r=this.rt(t);this.dt(t,e)?r.$e(e,1):r.Ue(e),this.Ye=this.Ye.insert(e,this.At(e).delete(t)),this.Ye=this.Ye.insert(e,this.At(e).add(t)),n&&(this.He=this.He.insert(e,n))}removeTarget(t){this.je.delete(t)}ut(t){const e=this.rt(t).qe();return this.ze.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ke(t){this.rt(t).Ke()}rt(t){let e=this.je.get(t);return e||(e=new rs,this.je.set(t,e)),e}At(t){let e=this.Ye.get(t);return e||(e=new Tn(Ne),this.Ye=this.Ye.insert(t,e)),e}Et(t){let e=this.Je.get(t);return e||(e=new Tn(Ne),this.Je=this.Je.insert(t,e)),e}it(t){const e=null!==this._t(t);return e||ce("WatchChangeAggregator","Detected inactive target",t),e}_t(t){const e=this.je.get(t);return e&&e.Be?null:this.ze.Rt(t)}st(t){this.je.set(t,new rs),this.ze.getRemoteKeysForTarget(t).forEach(e=>{this.tt(t,e,null)})}dt(t,e){return this.ze.getRemoteKeysForTarget(t).has(e)}}function ss(){return new wn(ze.comparator)}function os(){return new wn(ze.comparator)}const as={asc:"ASCENDING",desc:"DESCENDING"},cs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},us={and:"AND",or:"OR"};class hs{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function ls(t,e){return t.useProto3Json||Ze(e)?e:{value:e}}function ds(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function fs(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function ps(t,e){return ds(t,e.toTimestamp())}function gs(t){return pe(!!t,49232),Fe.fromTimestamp(function(t){const e=Dn(t);return new Ve(e.seconds,e.nanos)}(t))}function ms(t,e){return ys(t,e).canonicalString()}function ys(t,e){const n=function(t){return new je(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function vs(t){const e=je.fromString(t);return pe(Ps(e),10190,{key:e.toString()}),e}function ws(t,e){return ms(t.databaseId,e.path)}function bs(t,e){const n=vs(e);if(n.get(1)!==t.databaseId.projectId)throw new ye(me.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new ye(me.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new ze(_s(n))}function Es(t,e){return ms(t.databaseId,e)}function Ts(t){return new je(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function _s(t){return pe(t.length>4&&"documents"===t.get(4),29091,{key:t.toString()}),t.popFirst(5)}function Cs(t,e,n){return{name:ws(t,e),fields:n.value.mapValue.fields}}function Is(t,e){return{documents:[Es(t,e.path)]}}function Ss(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Es(t,i);const s=function(t){if(0!==t.length)return Ls(wr.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map(t=>function(t){return{field:Rs(t.field),direction:ks(t.dir)}}(t))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=ls(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{gt:n,parent:i}}function As(t){let e=function(t){const e=vs(t);return 4===e.length?je.emptyPath():_s(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){pe(1===r,65062);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Ds(t);return e instanceof wr&&Er(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map(t=>function(t){return new gr(Os(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ze(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new dr(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new dr(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Fr(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function Ds(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Os(t.unaryFilter.field);return vr.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Os(t.unaryFilter.field);return vr.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Os(t.unaryFilter.field);return vr.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Os(t.unaryFilter.field);return vr.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return de(61313);default:return de(60726)}}(t):void 0!==t.fieldFilter?function(t){return vr.create(Os(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return de(58110);default:return de(50506)}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return wr.create(t.compositeFilter.filters.map(t=>Ds(t)),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return de(1026)}}(t.compositeFilter.op))}(t):de(30097,{filter:t})}function ks(t){return as[t]}function Ns(t){return cs[t]}function xs(t){return us[t]}function Rs(t){return{fieldPath:t.canonicalString()}}function Os(t){return $e.fromServerFormat(t.fieldPath)}function Ls(t){return t instanceof vr?function(t){if("=="===t.op){if(ir(t.value))return{unaryFilter:{field:Rs(t.field),op:"IS_NAN"}};if(rr(t.value))return{unaryFilter:{field:Rs(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(ir(t.value))return{unaryFilter:{field:Rs(t.field),op:"IS_NOT_NAN"}};if(rr(t.value))return{unaryFilter:{field:Rs(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Rs(t.field),op:Ns(t.op),value:t.value}}}(t):t instanceof wr?function(t){const e=t.getFilters().map(t=>Ls(t));return 1===e.length?e[0]:{compositeFilter:{op:xs(t.op),filters:e}}}(t):de(54877,{filter:t})}function Ms(t){const e=[];return t.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function Ps(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Vs{constructor(t,e,n,r,i=Fe.min(),s=Fe.min(),o=Sn.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Vs(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Vs(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Vs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Vs(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Fs{constructor(t){this.wt=t}}function Us(t){const e=As({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?$r(e,e.limit,"L"):e}class Bs{constructor(){}vt(t,e){this.Ct(t,e),e.Ft()}Ct(t,e){if("nullValue"in t)this.Mt(e,5);else if("booleanValue"in t)this.Mt(e,10),e.xt(t.booleanValue?1:0);else if("integerValue"in t)this.Mt(e,15),e.xt(kn(t.integerValue));else if("doubleValue"in t){const n=kn(t.doubleValue);isNaN(n)?this.Mt(e,13):(this.Mt(e,15),tn(n)?e.xt(0):e.xt(n))}else if("timestampValue"in t){let n=t.timestampValue;this.Mt(e,20),"string"==typeof n&&(n=Dn(n)),e.Ot(`${n.seconds||""}`),e.xt(n.nanos||0)}else if("stringValue"in t)this.Nt(t.stringValue,e),this.Bt(e);else if("bytesValue"in t)this.Mt(e,30),e.Lt(Nn(t.bytesValue)),this.Bt(e);else if("referenceValue"in t)this.kt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Mt(e,45),e.xt(n.latitude||0),e.xt(n.longitude||0)}else"mapValue"in t?cr(t)?this.Mt(e,Number.MAX_SAFE_INTEGER):or(t)?this.qt(t.mapValue,e):(this.Qt(t.mapValue,e),this.Bt(e)):"arrayValue"in t?(this.$t(t.arrayValue,e),this.Bt(e)):de(19022,{Ut:t})}Nt(t,e){this.Mt(e,25),this.Kt(t,e)}Kt(t,e){e.Ot(t)}Qt(t,e){const n=t.fields||{};this.Mt(e,55);for(const t of Object.keys(n))this.Nt(t,e),this.Ct(n[t],e)}qt(t,e){var n,r;const i=t.fields||{};this.Mt(e,53);const s=Kn,o=(null===(r=null===(n=i[s].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.length)||0;this.Mt(e,15),e.xt(kn(o)),this.Nt(s,e),this.Ct(i[s],e)}$t(t,e){const n=t.values||[];this.Mt(e,50);for(const t of n)this.Ct(t,e)}kt(t,e){this.Mt(e,37),ze.fromName(t).path.forEach(t=>{this.Mt(e,60),this.Kt(t,e)})}Mt(t,e){t.xt(e)}Bt(t){t.xt(2)}}Bs.Wt=new Bs;class js{constructor(){this.Cn=new qs}addToCollectionParentIndex(t,e){return this.Cn.add(e),Xe.resolve()}getCollectionParents(t,e){return Xe.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return Xe.resolve()}deleteFieldIndex(t,e){return Xe.resolve()}deleteAllFieldIndexes(t){return Xe.resolve()}createTargetIndexes(t,e){return Xe.resolve()}getDocumentsMatchingTarget(t,e){return Xe.resolve(null)}getIndexType(t,e){return Xe.resolve(0)}getFieldIndexes(t,e){return Xe.resolve([])}getNextCollectionGroupToUpdate(t){return Xe.resolve(null)}getMinOffset(t,e){return Xe.resolve(He.min())}getMinOffsetFromCollectionGroup(t,e){return Xe.resolve(He.min())}updateCollectionGroup(t,e,n){return Xe.resolve()}updateIndexEntries(t,e){return Xe.resolve()}}class qs{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Tn(je.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Tn(je.comparator)).toArray()}}new Uint8Array(0);const $s={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},zs=41943040;class Ks{static withCacheSize(t){return new Ks(t,Ks.DEFAULT_COLLECTION_PERCENTILE,Ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}}Ks.DEFAULT_COLLECTION_PERCENTILE=10,Ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ks.DEFAULT=new Ks(zs,Ks.DEFAULT_COLLECTION_PERCENTILE,Ks.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ks.DISABLED=new Ks(-1,0,0);class Hs{constructor(t){this.ur=t}next(){return this.ur+=2,this.ur}static cr(){return new Hs(0)}static lr(){return new Hs(-1)}}const Gs="LruGarbageCollector";function Qs([t,e],[n,r]){const i=Ne(t,n);return 0===i?Ne(e,r):i}class Ws{constructor(t){this.Er=t,this.buffer=new Tn(Qs),this.dr=0}Ar(){return++this.dr}Rr(t){const e=[t,this.Ar()];if(this.buffer.size<this.Er)this.buffer=this.buffer.add(e);else{const t=this.buffer.last();Qs(e,t)<0&&(this.buffer=this.buffer.delete(t).add(e))}}get maxValue(){return this.buffer.last()[0]}}class Xs{constructor(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.Vr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.mr(6e4)}stop(){this.Vr&&(this.Vr.cancel(),this.Vr=null)}get started(){return null!==this.Vr}mr(t){ce(Gs,`Garbage collection scheduled in ${t}ms`),this.Vr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,async()=>{this.Vr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(t){Ye(t)?ce(Gs,"Ignoring IndexedDB error during garbage collection: ",t):await We(t)}await this.mr(3e5)})}}class Ys{constructor(t,e){this.gr=t,this.params=e}calculateTargetCount(t,e){return this.gr.pr(t).next(t=>Math.floor(e/100*t))}nthSequenceNumber(t,e){if(0===e)return Xe.resolve(Je.le);const n=new Ws(e);return this.gr.forEachTarget(t,t=>n.Rr(t.sequenceNumber)).next(()=>this.gr.yr(t,t=>n.Rr(t))).next(()=>n.maxValue)}removeTargets(t,e,n){return this.gr.removeTargets(t,e,n)}removeOrphanedDocuments(t,e){return this.gr.removeOrphanedDocuments(t,e)}collect(t,e){return-1===this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector","Garbage collection skipped; disabled"),Xe.resolve($s)):this.getCacheSize(t).next(n=>n<this.params.cacheSizeCollectionThreshold?(ce("LruGarbageCollector",`Garbage collection skipped; Cache size ${n} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),$s):this.wr(t,e))}getCacheSize(t){return this.gr.getCacheSize(t)}wr(t,e){let n,r,i,s,o,a,c;const u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(e=>(e>this.params.maximumSequenceNumbersToCollect?(ce("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${e}`),r=this.params.maximumSequenceNumbersToCollect):r=e,s=Date.now(),this.nthSequenceNumber(t,r))).next(r=>(n=r,o=Date.now(),this.removeTargets(t,n,e))).next(e=>(i=e,a=Date.now(),this.removeOrphanedDocuments(t,n))).next(t=>(c=Date.now(),ae()<=C.DEBUG&&ce("LruGarbageCollector",`LRU Garbage Collection\n\tCounted targets in ${s-u}ms\n\tDetermined least recently used ${r} in `+(o-s)+"ms\n"+`\tRemoved ${i} targets in `+(a-o)+"ms\n"+`\tRemoved ${t} documents in `+(c-a)+"ms\n"+`Total Duration: ${c-u}ms`),Xe.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})))}}class Js{constructor(){this.changes=new Xr(t=>t.toString(),(t,e)=>t.isEqual(e)),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,lr.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?Xe.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Zs{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class to{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next(r=>(n=r,this.remoteDocumentCache.getEntry(t,e))).next(t=>(null!==n&&Ni(n.mutation,t,Cn.empty(),Ve.now()),t))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.getLocalViewOfDocuments(t,e,ai()).next(()=>e))}getLocalViewOfDocuments(t,e,n=ai()){const r=ni();return this.populateOverlays(t,r,e).next(()=>this.computeViews(t,e,r,n).next(t=>{let e=ti();return t.forEach((t,n)=>{e=e.insert(t,n.overlayedDocument)}),e}))}getOverlayedDocuments(t,e){const n=ni();return this.populateOverlays(t,n,e).next(()=>this.computeViews(t,e,n,ai()))}populateOverlays(t,e,n){const r=[];return n.forEach(t=>{e.has(t)||r.push(t)}),this.documentOverlayCache.getOverlays(t,r).next(t=>{t.forEach((t,n)=>{e.set(t,n)})})}computeViews(t,e,n,r){let i=Jr();const s=ii(),o=ii();return e.forEach((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof Li)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Ni(o.mutation,e,o.mutation.getFieldMask(),Ve.now())):s.set(e.key,Cn.empty())}),this.recalculateAndSaveOverlays(t,i).next(t=>(t.forEach((t,e)=>s.set(t,e)),e.forEach((t,e)=>{var n;return o.set(t,new Zs(e,null!==(n=s.get(t))&&void 0!==n?n:null))}),o))}recalculateAndSaveOverlays(t,e){const n=ii();let r=new wn((t,e)=>t-e),i=ai();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(t=>{for(const i of t)i.keys().forEach(t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||Cn.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ai()).add(t);r=r.insert(i.batchId,a)})}).next(()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=ri();c.forEach(t=>{if(!i.has(t)){const r=Di(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}}),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return Xe.waitFor(s)}).next(()=>n)}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next(e=>this.recalculateAndSaveOverlays(t,e))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return ze.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next(i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):Xe.resolve(ni());let o=-1,a=i;return s.next(e=>Xe.forEach(e,(e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?Xe.resolve():this.remoteDocumentCache.getEntry(t,e).next(t=>{a=a.insert(e,t)}))).next(()=>this.populateOverlays(t,e,i)).next(()=>this.computeViews(t,a,e,ai())).next(t=>({batchId:o,changes:ei(t)})))})}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new ze(e)).next(t=>{let e=ti();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=ti();return this.indexManager.getCollectionParents(t,i).next(o=>Xe.forEach(o,o=>{const a=function(t,e){return new Fr(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next(t=>{t.forEach((t,e)=>{s=s.insert(t,e)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r))).next(t=>{i.forEach((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,lr.newInvalidDocument(r)))});let n=ti();return t.forEach((t,r)=>{const s=i.get(t);void 0!==s&&Ni(s.mutation,r,Cn.empty(),Ve.now()),Gr(e,r)&&(n=n.insert(t,r))}),n})}}class eo{constructor(t){this.serializer=t,this.kr=new Map,this.qr=new Map}getBundleMetadata(t,e){return Xe.resolve(this.kr.get(e))}saveBundleMetadata(t,e){return this.kr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:gs(t.createTime)}}(e)),Xe.resolve()}getNamedQuery(t,e){return Xe.resolve(this.qr.get(e))}saveNamedQuery(t,e){return this.qr.set(e.name,function(t){return{name:t.name,query:Us(t.bundledQuery),readTime:gs(t.readTime)}}(e)),Xe.resolve()}}class no{constructor(){this.overlays=new wn(ze.comparator),this.Qr=new Map}getOverlay(t,e){return Xe.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ni();return Xe.forEach(e,e=>this.getOverlay(t,e).next(t=>{null!==t&&n.set(e,t)})).next(()=>n)}saveOverlays(t,e,n){return n.forEach((n,r)=>{this.St(t,e,r)}),Xe.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.Qr.get(n);return void 0!==r&&(r.forEach(t=>this.overlays=this.overlays.remove(t)),this.Qr.delete(n)),Xe.resolve()}getOverlaysForCollection(t,e,n){const r=ni(),i=e.length+1,s=new ze(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return Xe.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new wn((t,e)=>t-e);const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=ni(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ni(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((t,e)=>o.set(t,e)),!(o.size()>=r)););return Xe.resolve(o)}St(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.Qr.get(r.largestBatchId).delete(n.key);this.Qr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new qi(e,n));let i=this.Qr.get(e);void 0===i&&(i=ai(),this.Qr.set(e,i)),this.Qr.set(e,i.add(n.key))}}class ro{constructor(){this.sessionToken=Sn.EMPTY_BYTE_STRING}getSessionToken(t){return Xe.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,Xe.resolve()}}class io{constructor(){this.$r=new Tn(so.Ur),this.Kr=new Tn(so.Wr)}isEmpty(){return this.$r.isEmpty()}addReference(t,e){const n=new so(t,e);this.$r=this.$r.add(n),this.Kr=this.Kr.add(n)}Gr(t,e){t.forEach(t=>this.addReference(t,e))}removeReference(t,e){this.zr(new so(t,e))}jr(t,e){t.forEach(t=>this.removeReference(t,e))}Hr(t){const e=new ze(new je([])),n=new so(e,t),r=new so(e,t+1),i=[];return this.Kr.forEachInRange([n,r],t=>{this.zr(t),i.push(t.key)}),i}Jr(){this.$r.forEach(t=>this.zr(t))}zr(t){this.$r=this.$r.delete(t),this.Kr=this.Kr.delete(t)}Yr(t){const e=new ze(new je([])),n=new so(e,t),r=new so(e,t+1);let i=ai();return this.Kr.forEachInRange([n,r],t=>{i=i.add(t.key)}),i}containsKey(t){const e=new so(t,0),n=this.$r.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class so{constructor(t,e){this.key=t,this.Zr=e}static Ur(t,e){return ze.comparator(t.key,e.key)||Ne(t.Zr,e.Zr)}static Wr(t,e){return Ne(t.Zr,e.Zr)||ze.comparator(t.key,e.key)}}class oo{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nr=1,this.Xr=new Tn(so.Ur)}checkEmpty(t){return Xe.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.nr;this.nr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Bi(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.Xr=this.Xr.add(new so(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return Xe.resolve(s)}lookupMutationBatch(t,e){return Xe.resolve(this.ei(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.ti(n),i=r<0?0:r;return Xe.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return Xe.resolve(0===this.mutationQueue.length?-1:this.nr-1)}getAllMutationBatches(t){return Xe.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new so(e,0),r=new so(e,Number.POSITIVE_INFINITY),i=[];return this.Xr.forEachInRange([n,r],t=>{const e=this.ei(t.Zr);i.push(e)}),Xe.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Tn(Ne);return e.forEach(t=>{const e=new so(t,0),r=new so(t,Number.POSITIVE_INFINITY);this.Xr.forEachInRange([e,r],t=>{n=n.add(t.Zr)})}),Xe.resolve(this.ni(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;ze.isDocumentKey(i)||(i=i.child(""));const s=new so(new ze(i),0);let o=new Tn(Ne);return this.Xr.forEachWhile(t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.Zr)),!0)},s),Xe.resolve(this.ni(o))}ni(t){const e=[];return t.forEach(t=>{const n=this.ei(t);null!==n&&e.push(n)}),e}removeMutationBatch(t,e){pe(0===this.ri(e.batchId,"removed"),55003),this.mutationQueue.shift();let n=this.Xr;return Xe.forEach(e.mutations,r=>{const i=new so(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)}).next(()=>{this.Xr=n})}sr(t){}containsKey(t,e){const n=new so(e,0),r=this.Xr.firstAfterOrEqual(n);return Xe.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,Xe.resolve()}ri(t,e){return this.ti(t)}ti(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}ei(t){const e=this.ti(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class ao{constructor(t){this.ii=t,this.docs=new wn(ze.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.ii(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return Xe.resolve(n?n.document.mutableCopy():lr.newInvalidDocument(e))}getEntries(t,e){let n=Jr();return e.forEach(t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():lr.newInvalidDocument(t))}),Xe.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=Jr();const s=e.path,o=new ze(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||Ge(Ke(o),n)<=0||(r.has(o.key)||Gr(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return Xe.resolve(i)}getAllFromCollectionGroup(t,e,n,r){de(9500)}si(t,e){return Xe.forEach(this.docs,t=>e(t))}newChangeBuffer(t){return new co(this)}getSize(t){return Xe.resolve(this.size)}}class co extends Js{constructor(t){super(),this.Br=t}applyChanges(t){const e=[];return this.changes.forEach((n,r)=>{r.isValidDocument()?e.push(this.Br.addEntry(t,r)):this.Br.removeEntry(n)}),Xe.waitFor(e)}getFromCache(t,e){return this.Br.getEntry(t,e)}getAllFromCache(t,e){return this.Br.getEntries(t,e)}}class uo{constructor(t){this.persistence=t,this.oi=new Xr(t=>Mr(t),Pr),this.lastRemoteSnapshotVersion=Fe.min(),this.highestTargetId=0,this._i=0,this.ai=new io,this.targetCount=0,this.ui=Hs.cr()}forEachTarget(t,e){return this.oi.forEach((t,n)=>e(n)),Xe.resolve()}getLastRemoteSnapshotVersion(t){return Xe.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return Xe.resolve(this._i)}allocateTargetId(t){return this.highestTargetId=this.ui.next(),Xe.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this._i&&(this._i=e),Xe.resolve()}Tr(t){this.oi.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ui=new Hs(e),this.highestTargetId=e),t.sequenceNumber>this._i&&(this._i=t.sequenceNumber)}addTargetData(t,e){return this.Tr(e),this.targetCount+=1,Xe.resolve()}updateTargetData(t,e){return this.Tr(e),Xe.resolve()}removeTargetData(t,e){return this.oi.delete(e.target),this.ai.Hr(e.targetId),this.targetCount-=1,Xe.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.oi.forEach((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.oi.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)}),Xe.waitFor(i).next(()=>r)}getTargetCount(t){return Xe.resolve(this.targetCount)}getTargetData(t,e){const n=this.oi.get(e)||null;return Xe.resolve(n)}addMatchingKeys(t,e,n){return this.ai.Gr(e,n),Xe.resolve()}removeMatchingKeys(t,e,n){this.ai.jr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(e=>{i.push(r.markPotentiallyOrphaned(t,e))}),Xe.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.ai.Hr(e),Xe.resolve()}getMatchingKeysForTargetId(t,e){const n=this.ai.Yr(e);return Xe.resolve(n)}containsKey(t,e){return Xe.resolve(this.ai.containsKey(e))}}class ho{constructor(t,e){this.ci={},this.overlays={},this.li=new Je(0),this.hi=!1,this.hi=!0,this.Pi=new ro,this.referenceDelegate=t(this),this.Ti=new uo(this),this.indexManager=new js,this.remoteDocumentCache=function(t){return new ao(t)}(t=>this.referenceDelegate.Ii(t)),this.serializer=new Fs(e),this.Ei=new eo(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.hi=!1,Promise.resolve()}get started(){return this.hi}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new no,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.ci[t.toKey()];return n||(n=new oo(e,this.referenceDelegate),this.ci[t.toKey()]=n),n}getGlobalsCache(){return this.Pi}getTargetCache(){return this.Ti}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ei}runTransaction(t,e,n){ce("MemoryPersistence","Starting transaction:",t);const r=new lo(this.li.next());return this.referenceDelegate.di(),n(r).next(t=>this.referenceDelegate.Ai(r).next(()=>t)).toPromise().then(t=>(r.raiseOnCommittedEvent(),t))}Ri(t,e){return Xe.or(Object.values(this.ci).map(n=>()=>n.containsKey(t,e)))}}class lo extends Qe{constructor(t){super(),this.currentSequenceNumber=t}}class fo{constructor(t){this.persistence=t,this.Vi=new io,this.mi=null}static fi(t){return new fo(t)}get gi(){if(this.mi)return this.mi;throw de(60996)}addReference(t,e,n){return this.Vi.addReference(n,e),this.gi.delete(n.toString()),Xe.resolve()}removeReference(t,e,n){return this.Vi.removeReference(n,e),this.gi.add(n.toString()),Xe.resolve()}markPotentiallyOrphaned(t,e){return this.gi.add(e.toString()),Xe.resolve()}removeTarget(t,e){this.Vi.Hr(e.targetId).forEach(t=>this.gi.add(t.toString()));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next(t=>{t.forEach(t=>this.gi.add(t.toString()))}).next(()=>n.removeTargetData(t,e))}di(){this.mi=new Set}Ai(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Xe.forEach(this.gi,n=>{const r=ze.fromPath(n);return this.pi(t,r).next(t=>{t||e.removeEntry(r,Fe.min())})}).next(()=>(this.mi=null,e.apply(t)))}updateLimboDocument(t,e){return this.pi(t,e).next(t=>{t?this.gi.delete(e.toString()):this.gi.add(e.toString())})}Ii(t){return 0}pi(t,e){return Xe.or([()=>Xe.resolve(this.Vi.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ri(t,e)])}}class po{constructor(t,e){this.persistence=t,this.yi=new Xr(t=>function(t){let e="";for(let n=0;n<t.length;n++)e.length>0&&(e=nn(e)),e=en(t.get(n),e);return nn(e)}(t.path),(t,e)=>t.isEqual(e)),this.garbageCollector=function(t,e){return new Ys(t,e)}(this,e)}static fi(t,e){return new po(t,e)}di(){}Ai(t){return Xe.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}pr(t){const e=this.br(t);return this.persistence.getTargetCache().getTargetCount(t).next(t=>e.next(e=>t+e))}br(t){let e=0;return this.yr(t,t=>{e++}).next(()=>e)}yr(t,e){return Xe.forEach(this.yi,(n,r)=>this.Dr(t,n,r).next(t=>t?Xe.resolve():e(r)))}removeTargets(t,e,n){return this.persistence.getTargetCache().removeTargets(t,e,n)}removeOrphanedDocuments(t,e){let n=0;const r=this.persistence.getRemoteDocumentCache(),i=r.newChangeBuffer();return r.si(t,r=>this.Dr(t,r,e).next(t=>{t||(n++,i.removeEntry(r,Fe.min()))})).next(()=>i.apply(t)).next(()=>n)}markPotentiallyOrphaned(t,e){return this.yi.set(e,t.currentSequenceNumber),Xe.resolve()}removeTarget(t,e){const n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,n)}addReference(t,e,n){return this.yi.set(n,t.currentSequenceNumber),Xe.resolve()}removeReference(t,e,n){return this.yi.set(n,t.currentSequenceNumber),Xe.resolve()}updateLimboDocument(t,e){return this.yi.set(e,t.currentSequenceNumber),Xe.resolve()}Ii(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=tr(t.data.value)),e}Dr(t,e,n){return Xe.or([()=>this.persistence.Ri(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const t=this.yi.get(e);return Xe.resolve(void 0!==t&&t>n)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class go{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.ds=n,this.As=r}static Rs(t,e){let n=ai(),r=ai();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new go(t,e.fromCache,n,r)}}class mo{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class yo{constructor(){this.Vs=!1,this.fs=!1,this.gs=100,this.ps=d()?8:function(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}("undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:"")>0?6:4}initialize(t,e){this.ys=t,this.indexManager=e,this.Vs=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ws(t,e).next(t=>{i.result=t}).next(()=>{if(!i.result)return this.bs(t,e,r,n).next(t=>{i.result=t})}).next(()=>{if(i.result)return;const n=new mo;return this.Ss(t,e,n).next(r=>{if(i.result=r,this.fs)return this.Ds(t,e,n,r.size)})}).next(()=>i.result)}Ds(t,e,n,r){return n.documentReadCount<this.gs?(ae()<=C.DEBUG&&ce("QueryEngine","SDK will not create cache indexes for query:",Hr(e),"since it only creates cache indexes for collection contains","more than or equal to",this.gs,"documents"),Xe.resolve()):(ae()<=C.DEBUG&&ce("QueryEngine","Query:",Hr(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.ps*r?(ae()<=C.DEBUG&&ce("QueryEngine","The SDK decides to create cache indexes for query:",Hr(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,qr(e))):Xe.resolve())}ws(t,e){if(Br(e))return Xe.resolve(null);let n=qr(e);return this.indexManager.getIndexType(t,n).next(r=>0===r?null:(null!==e.limit&&1===r&&(e=$r(e,null,"F"),n=qr(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next(r=>{const i=ai(...r);return this.ys.getDocuments(t,i).next(r=>this.indexManager.getMinOffset(t,n).next(n=>{const s=this.vs(e,r);return this.Cs(e,s,i,n.readTime)?this.ws(t,$r(e,null,"F")):this.Fs(t,s,e,n)}))})))}bs(t,e,n,r){return Br(e)||r.isEqual(Fe.min())?Xe.resolve(null):this.ys.getDocuments(t,n).next(i=>{const s=this.vs(e,i);return this.Cs(e,s,n,r)?Xe.resolve(null):(ae()<=C.DEBUG&&ce("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Hr(e)),this.Fs(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=Fe.fromTimestamp(1e9===r?new Ve(n+1,0):new Ve(n,r));return new He(i,ze.empty(),e)}(r,-1)).next(t=>t))})}vs(t,e){let n=new Tn(Qr(t));return e.forEach((e,r)=>{Gr(t,r)&&(n=n.add(r))}),n}Cs(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ss(t,e,n){return ae()<=C.DEBUG&&ce("QueryEngine","Using full collection scan to execute query:",Hr(e)),this.ys.getDocumentsMatchingQuery(t,e,He.min(),n)}Fs(t,e,n,r){return this.ys.getDocumentsMatchingQuery(t,n,r).next(t=>(e.forEach(e=>{t=t.insert(e.key,e)}),t))}}const vo="LocalStore";class wo{constructor(t,e,n,r){this.persistence=t,this.Ms=e,this.serializer=r,this.xs=new wn(Ne),this.Os=new Xr(t=>Mr(t),Pr),this.Ns=new Map,this.Bs=t.getRemoteDocumentCache(),this.Ti=t.getTargetCache(),this.Ei=t.getBundleCache(),this.Ls(n)}Ls(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new to(this.Bs,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Bs.setIndexManager(this.indexManager),this.Ms.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",e=>t.collect(e,this.xs))}}async function bo(t,e){const n=ge(t);return await n.persistence.runTransaction("Handle user change","readonly",t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next(i=>(r=i,n.Ls(e),n.mutationQueue.getAllMutationBatches(t))).next(e=>{const i=[],s=[];let o=ai();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next(t=>({ks:t,removedBatchIds:i,addedBatchIds:s}))})})}function Eo(t){const e=ge(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.Ti.getLastRemoteSnapshotVersion(t))}function To(t,e){const n=ge(t);return n.persistence.runTransaction("Get next mutation batch","readonly",t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e)))}async function _o(t,e,n){const r=ge(t),i=r.xs.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,t=>r.persistence.referenceDelegate.removeTarget(t,i))}catch(t){if(!Ye(t))throw t;ce(vo,`Failed to update sequence numbers for target ${e}: ${t}`)}r.xs=r.xs.remove(e),r.Os.delete(i.target)}function Co(t,e,n){const r=ge(t);let i=Fe.min(),s=ai();return r.persistence.runTransaction("Execute query","readwrite",t=>function(t,e,n){const r=ge(t),i=r.Os.get(n);return void 0!==i?Xe.resolve(r.xs.get(i)):r.Ti.getTargetData(e,n)}(r,t,qr(e)).next(e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Ti.getMatchingKeysForTargetId(t,e.targetId).next(t=>{s=t})}).next(()=>r.Ms.getDocumentsMatchingQuery(t,e,n?i:Fe.min(),n?s:ai())).next(t=>(function(t,e,n){let r=t.Ns.get(e)||Fe.min();n.forEach((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)}),t.Ns.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,$s:s})))}class Io{constructor(){this.activeTargetIds=ci}js(t){this.activeTargetIds=this.activeTargetIds.add(t)}Hs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}zs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class So{constructor(){this.xo=new Io,this.Oo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t,e=!0){return e&&this.xo.js(t),this.Oo[t]||"not-current"}updateQueryState(t,e,n){this.Oo[t]=e}removeLocalQueryTarget(t){this.xo.Hs(t)}isLocalQueryTarget(t){return this.xo.activeTargetIds.has(t)}clearQueryState(t){delete this.Oo[t]}getAllActiveQueryTargets(){return this.xo.activeTargetIds}isActiveQueryTarget(t){return this.xo.activeTargetIds.has(t)}start(){return this.xo=new Io,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Ao{No(t){}shutdown(){}}const Do="ConnectivityMonitor";class ko{constructor(){this.Bo=()=>this.Lo(),this.ko=()=>this.qo(),this.Qo=[],this.$o()}No(t){this.Qo.push(t)}shutdown(){window.removeEventListener("online",this.Bo),window.removeEventListener("offline",this.ko)}$o(){window.addEventListener("online",this.Bo),window.addEventListener("offline",this.ko)}Lo(){ce(Do,"Network connectivity changed: AVAILABLE");for(const t of this.Qo)t(0)}qo(){ce(Do,"Network connectivity changed: UNAVAILABLE");for(const t of this.Qo)t(1)}static C(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let No=null;function xo(){return null===No?No=268435456+Math.round(2147483648*Math.random()):No++,"0x"+No.toString(16)}const Ro="RestConnection",Oo={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Lo{get Uo(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.Ko=e+"://"+t.host,this.Wo=`projects/${n}/databases/${r}`,this.Go=this.databaseId.database===Un?`project_id=${n}`:`project_id=${n}&database_id=${r}`}zo(t,e,n,r,i){const s=xo(),o=this.jo(t,e.toUriEncodedString());ce(Ro,`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.Wo,"x-goog-request-params":this.Go};this.Ho(a,r,i);const{host:u}=new URL(o),h=c(u);return this.Jo(t,o,a,n,h).then(e=>(ce(Ro,`Received RPC '${t}' ${s}: `,e),e),e=>{throw he(Ro,`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e})}Yo(t,e,n,r,i,s){return this.zo(t,e,n,r,i)}Ho(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+se,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach((e,n)=>t[n]=e),n&&n.headers.forEach((e,n)=>t[n]=e)}jo(t,e){const n=Oo[t];return`${this.Ko}/v1/${e}:${n}`}terminate(){}}class Mo{constructor(t){this.Zo=t.Zo,this.Xo=t.Xo}e_(t){this.t_=t}n_(t){this.r_=t}i_(t){this.s_=t}onMessage(t){this.o_=t}close(){this.Xo()}send(t){this.Zo(t)}__(){this.t_()}a_(){this.r_()}u_(t){this.s_(t)}c_(t){this.o_(t)}}const Po="WebChannelConnection";class Vo extends Lo{constructor(t){super(t),this.l_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,n,r,i){const s=xo();return new Promise((i,o)=>{const a=new Ht;a.setWithCredentials(!0),a.listenOnce(Qt.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case Wt.NO_ERROR:const e=a.getResponseJson();ce(Po,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Wt.TIMEOUT:ce(Po,`RPC '${t}' ${s} timed out`),o(new ye(me.DEADLINE_EXCEEDED,"Request time out"));break;case Wt.HTTP_ERROR:const n=a.getStatus();if(ce(Po,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(me).indexOf(e)>=0?e:me.UNKNOWN}(e.status);o(new ye(t,e.message))}else o(new ye(me.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new ye(me.UNAVAILABLE,"Connection failed."));break;default:de(9055,{h_:t,streamId:s,P_:a.getLastErrorCode(),T_:a.getLastError()})}}finally{ce(Po,`RPC '${t}' ${s} completed.`)}});const c=JSON.stringify(r);ce(Po,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",c,n,15)})}I_(t,e,n){const r=xo(),i=[this.Ko,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Zt(),o=Jt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Ho(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");ce(Po,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);this.E_(h);let l=!1,d=!1;const f=new Mo({Zo:e=>{d?ce(Po,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(ce(Po,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),ce(Po,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},Xo:()=>h.close()}),p=(t,e,n)=>{t.listen(e,t=>{try{n(t)}catch(t){setTimeout(()=>{throw t},0)}})};return p(h,Gt.EventType.OPEN,()=>{d||(ce(Po,`RPC '${t}' stream ${r} transport opened.`),f.__())}),p(h,Gt.EventType.CLOSE,()=>{d||(d=!0,ce(Po,`RPC '${t}' stream ${r} transport closed`),f.u_(),this.d_(h))}),p(h,Gt.EventType.ERROR,e=>{d||(d=!0,he(Po,`RPC '${t}' stream ${r} transport errored. Name:`,e.name,"Message:",e.message),f.u_(new ye(me.UNAVAILABLE,"The operation could not be completed")))}),p(h,Gt.EventType.MESSAGE,e=>{var n;if(!d){const i=e.data[0];pe(!!i,16349);const s=i,o=(null==s?void 0:s.error)||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){ce(Po,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=zi[t];if(void 0!==e)return Hi(e)}(e),i=o.message;void 0===n&&(n=me.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.u_(new ye(n,i)),h.close()}else ce(Po,`RPC '${t}' stream ${r} received:`,i),f.c_(i)}}),p(o,Yt.STAT_EVENT,e=>{e.stat===Xt.PROXY?ce(Po,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===Xt.NOPROXY&&ce(Po,`RPC '${t}' stream ${r} detected no buffering proxy`)}),setTimeout(()=>{f.a_()},0),f}terminate(){this.l_.forEach(t=>t.close()),this.l_=[]}E_(t){this.l_.push(t)}d_(t){this.l_=this.l_.filter(e=>e===t)}}function Fo(){return"undefined"!=typeof document?document:null}function Uo(t){return new hs(t,!0)}class Bo{constructor(t,e,n=1e3,r=1.5,i=6e4){this.xi=t,this.timerId=e,this.A_=n,this.R_=r,this.V_=i,this.m_=0,this.f_=null,this.g_=Date.now(),this.reset()}reset(){this.m_=0}p_(){this.m_=this.V_}y_(t){this.cancel();const e=Math.floor(this.m_+this.w_()),n=Math.max(0,Date.now()-this.g_),r=Math.max(0,e-n);r>0&&ce("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.m_} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.f_=this.xi.enqueueAfterDelay(this.timerId,r,()=>(this.g_=Date.now(),t())),this.m_*=this.R_,this.m_<this.A_&&(this.m_=this.A_),this.m_>this.V_&&(this.m_=this.V_)}b_(){null!==this.f_&&(this.f_.skipDelay(),this.f_=null)}cancel(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}w_(){return(Math.random()-.5)*this.m_}}const jo="PersistentStream";class qo{constructor(t,e,n,r,i,s,o,a){this.xi=t,this.S_=n,this.D_=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.v_=0,this.C_=null,this.F_=null,this.stream=null,this.M_=0,this.x_=new Bo(t,e)}O_(){return 1===this.state||5===this.state||this.N_()}N_(){return 2===this.state||3===this.state}start(){this.M_=0,4!==this.state?this.auth():this.B_()}async stop(){this.O_()&&await this.close(0)}L_(){this.state=0,this.x_.reset()}k_(){this.N_()&&null===this.C_&&(this.C_=this.xi.enqueueAfterDelay(this.S_,6e4,()=>this.q_()))}Q_(t){this.U_(),this.stream.send(t)}async q_(){if(this.N_())return this.close(0)}U_(){this.C_&&(this.C_.cancel(),this.C_=null)}K_(){this.F_&&(this.F_.cancel(),this.F_=null)}async close(t,e){this.U_(),this.K_(),this.x_.cancel(),this.v_++,4!==t?this.x_.reset():e&&e.code===me.RESOURCE_EXHAUSTED?(ue(e.toString()),ue("Using maximum backoff delay to prevent overloading the backend."),this.x_.p_()):e&&e.code===me.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.W_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.i_(e)}W_(){}auth(){this.state=1;const t=this.G_(this.v_),e=this.v_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([t,n])=>{this.v_===e&&this.z_(t,n)},e=>{t(()=>{const t=new ye(me.UNKNOWN,"Fetching auth token failed: "+e.message);return this.j_(t)})})}z_(t,e){const n=this.G_(this.v_);this.stream=this.H_(t,e),this.stream.e_(()=>{n(()=>this.listener.e_())}),this.stream.n_(()=>{n(()=>(this.state=2,this.F_=this.xi.enqueueAfterDelay(this.D_,1e4,()=>(this.N_()&&(this.state=3),Promise.resolve())),this.listener.n_()))}),this.stream.i_(t=>{n(()=>this.j_(t))}),this.stream.onMessage(t=>{n(()=>1==++this.M_?this.J_(t):this.onNext(t))})}B_(){this.state=5,this.x_.y_(async()=>{this.state=0,this.start()})}j_(t){return ce(jo,`close with error: ${t}`),this.stream=null,this.close(4,t)}G_(t){return e=>{this.xi.enqueueAndForget(()=>this.v_===t?e():(ce(jo,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class $o extends qo{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}H_(t,e){return this.connection.I_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.x_.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:de(39313,{state:t})}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(pe(void 0===e||"string"==typeof e,58123),Sn.fromBase64String(e||"")):(pe(void 0===e||e instanceof Buffer||e instanceof Uint8Array,16193),Sn.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?me.UNKNOWN:Hi(t.code);return new ye(e,t.message||"")}(o);n=new ns(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=bs(t,r.document.name),s=gs(r.document.updateTime),o=r.document.createTime?gs(r.document.createTime):Fe.min(),a=new ur({mapValue:{fields:r.document.fields}}),c=lr.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new ts(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=bs(t,r.document),s=r.readTime?gs(r.readTime):Fe.min(),o=lr.newNoDocument(i,s),a=r.removedTargetIds||[];n=new ts([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=bs(t,r.document),s=r.removedTargetIds||[];n=new ts([],s,i,null)}else{if(!("filter"in e))return de(11601,{Vt:e});{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new $i(r,i),o=t.targetId;n=new es(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return Fe.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?Fe.min():e.readTime?gs(e.readTime):Fe.min()}(t);return this.listener.Y_(e,n)}Z_(t){const e={};e.database=Ts(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Vr(r)?{documents:Is(t,r)}:{query:Ss(t,r).gt},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=fs(t,e.resumeToken);const r=ls(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(Fe.min())>0){n.readTime=ds(t,e.snapshotVersion.toTimestamp());const r=ls(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return de(28987,{purpose:t})}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.Q_(e)}X_(t){const e={};e.database=Ts(this.serializer),e.removeTarget=t,this.Q_(e)}}class zo extends qo{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}get ea(){return this.M_>0}start(){this.lastStreamToken=void 0,super.start()}W_(){this.ea&&this.ta([])}H_(t,e){return this.connection.I_("Write",t,e)}J_(t){return pe(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,pe(!t.writeResults||0===t.writeResults.length,55816),this.listener.na()}onNext(t){pe(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.x_.reset();const e=function(t,e){return t&&t.length>0?(pe(void 0!==e,14353),t.map(t=>function(t,e){let n=t.updateTime?gs(t.updateTime):gs(e);return n.isEqual(Fe.min())&&(n=gs(e)),new Ci(n,t.transformResults||[])}(t,e))):[]}(t.writeResults,t.commitTime),n=gs(t.commitTime);return this.listener.ra(n,e)}ia(){const t={};t.database=Ts(this.serializer),this.Q_(t)}ta(t){const e={streamToken:this.lastStreamToken,writes:t.map(t=>function(t,e){let n;if(e instanceof Oi)n={update:Cs(t,e.key,e.value)};else if(e instanceof Fi)n={delete:ws(t,e.key)};else if(e instanceof Li)n={update:Cs(t,e.key,e.data),updateMask:Ms(e.fieldMask)};else{if(!(e instanceof Ui))return de(16599,{ft:e.type});n={verify:ws(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(t=>function(t,e){const n=e.transform;if(n instanceof mi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof yi)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof wi)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Ei)return{fieldPath:e.field.canonicalString(),increment:n.Re};throw de(20930,{transform:e.transform})}(0,t))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:ps(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:de(27497)}(t,e.precondition)),n}(this.serializer,t))};this.Q_(e)}}class Ko{}class Ho extends Ko{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.sa=!1}oa(){if(this.sa)throw new ye(me.FAILED_PRECONDITION,"The client has already been terminated.")}zo(t,e,n,r){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.zo(t,ys(e,n),r,i,s)).catch(t=>{throw"FirebaseError"===t.name?(t.code===me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ye(me.UNKNOWN,t.toString())})}Yo(t,e,n,r,i){return this.oa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.Yo(t,ys(e,n),r,s,o,i)).catch(t=>{throw"FirebaseError"===t.name?(t.code===me.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new ye(me.UNKNOWN,t.toString())})}terminate(){this.sa=!0,this.connection.terminate()}}class Go{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this._a=0,this.aa=null,this.ua=!0}ca(){0===this._a&&(this.la("Unknown"),this.aa=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this.aa=null,this.ha("Backend didn't respond within 10 seconds."),this.la("Offline"),Promise.resolve())))}Pa(t){"Online"===this.state?this.la("Unknown"):(this._a++,this._a>=1&&(this.Ta(),this.ha(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.la("Offline")))}set(t){this.Ta(),this._a=0,"Online"===t&&(this.ua=!1),this.la(t)}la(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}ha(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.ua?(ue(e),this.ua=!1):ce("OnlineStateTracker",e)}Ta(){null!==this.aa&&(this.aa.cancel(),this.aa=null)}}const Qo="RemoteStore";class Wo{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Ia=[],this.Ea=new Map,this.da=new Set,this.Aa=[],this.Ra=i,this.Ra.No(t=>{n.enqueueAndForget(async()=>{ia(this)&&(ce(Qo,"Restarting streams for network reachability change."),await async function(t){const e=ge(t);e.da.add(4),await Yo(e),e.Va.set("Unknown"),e.da.delete(4),await Xo(e)}(this))})}),this.Va=new Go(n,r)}}async function Xo(t){if(ia(t))for(const e of t.Aa)await e(!0)}async function Yo(t){for(const e of t.Aa)await e(!1)}function Jo(t,e){const n=ge(t);n.Ea.has(e.targetId)||(n.Ea.set(e.targetId,e),ra(n)?na(n):Ta(n).N_()&&ta(n,e))}function Zo(t,e){const n=ge(t),r=Ta(n);n.Ea.delete(e),r.N_()&&ea(n,e),0===n.Ea.size&&(r.N_()?r.k_():ia(n)&&n.Va.set("Unknown"))}function ta(t,e){if(t.ma.Ke(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(Fe.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Ta(t).Z_(e)}function ea(t,e){t.ma.Ke(e),Ta(t).X_(e)}function na(t){t.ma=new is({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),Rt:e=>t.Ea.get(e)||null,Pt:()=>t.datastore.serializer.databaseId}),Ta(t).start(),t.Va.ca()}function ra(t){return ia(t)&&!Ta(t).O_()&&t.Ea.size>0}function ia(t){return 0===ge(t).da.size}function sa(t){t.ma=void 0}async function oa(t){t.Va.set("Online")}async function aa(t){t.Ea.forEach((e,n)=>{ta(t,e)})}async function ca(t,e){sa(t),ra(t)?(t.Va.Pa(e),na(t)):t.Va.set("Unknown")}async function ua(t,e,n){if(t.Va.set("Online"),e instanceof ns&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.Ea.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.Ea.delete(r),t.ma.removeTarget(r))}(t,e)}catch(n){ce(Qo,"Failed to remove targets %s: %s ",e.targetIds.join(","),n),await ha(t,n)}else if(e instanceof ts?t.ma.Xe(e):e instanceof es?t.ma.ot(e):t.ma.nt(e),!n.isEqual(Fe.min()))try{const e=await Eo(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.ma.It(e);return n.targetChanges.forEach((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.Ea.get(r);i&&t.Ea.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach((e,n)=>{const r=t.Ea.get(e);if(!r)return;t.Ea.set(e,r.withResumeToken(Sn.EMPTY_BYTE_STRING,r.snapshotVersion)),ea(t,e);const i=new Vs(r.target,e,n,r.sequenceNumber);ta(t,i)}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){ce(Qo,"Failed to raise snapshot:",e),await ha(t,e)}}async function ha(t,e,n){if(!Ye(e))throw e;t.da.add(1),await Yo(t),t.Va.set("Offline"),n||(n=()=>Eo(t.localStore)),t.asyncQueue.enqueueRetryable(async()=>{ce(Qo,"Retrying IndexedDB access"),await n(),t.da.delete(1),await Xo(t)})}function la(t,e){return e().catch(n=>ha(t,n,e))}async function da(t){const e=ge(t),n=_a(e);let r=e.Ia.length>0?e.Ia[e.Ia.length-1].batchId:-1;for(;fa(e);)try{const t=await To(e.localStore,r);if(null===t){0===e.Ia.length&&n.k_();break}r=t.batchId,pa(e,t)}catch(t){await ha(e,t)}ga(e)&&ma(e)}function fa(t){return ia(t)&&t.Ia.length<10}function pa(t,e){t.Ia.push(e);const n=_a(t);n.N_()&&n.ea&&n.ta(e.mutations)}function ga(t){return ia(t)&&!_a(t).O_()&&t.Ia.length>0}function ma(t){_a(t).start()}async function ya(t){_a(t).ia()}async function va(t){const e=_a(t);for(const n of t.Ia)e.ta(n.mutations)}async function wa(t,e,n){const r=t.Ia.shift(),i=ji.from(r,e,n);await la(t,()=>t.remoteSyncer.applySuccessfulWrite(i)),await da(t)}async function ba(t,e){e&&_a(t).ea&&await async function(t,e){if(function(t){return function(t){switch(t){case me.OK:return de(64938);case me.CANCELLED:case me.UNKNOWN:case me.DEADLINE_EXCEEDED:case me.RESOURCE_EXHAUSTED:case me.INTERNAL:case me.UNAVAILABLE:case me.UNAUTHENTICATED:return!1;case me.INVALID_ARGUMENT:case me.NOT_FOUND:case me.ALREADY_EXISTS:case me.PERMISSION_DENIED:case me.FAILED_PRECONDITION:case me.ABORTED:case me.OUT_OF_RANGE:case me.UNIMPLEMENTED:case me.DATA_LOSS:return!0;default:return de(15467,{code:t})}}(t)&&t!==me.ABORTED}(e.code)){const n=t.Ia.shift();_a(t).L_(),await la(t,()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e)),await da(t)}}(t,e),ga(t)&&ma(t)}async function Ea(t,e){const n=ge(t);n.asyncQueue.verifyOperationInProgress(),ce(Qo,"RemoteStore received new credentials");const r=ia(n);n.da.add(3),await Yo(n),r&&n.Va.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.da.delete(3),await Xo(n)}function Ta(t){return t.fa||(t.fa=function(t,e,n){const r=ge(t);return r.oa(),new $o(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{e_:oa.bind(null,t),n_:aa.bind(null,t),i_:ca.bind(null,t),Y_:ua.bind(null,t)}),t.Aa.push(async e=>{e?(t.fa.L_(),ra(t)?na(t):t.Va.set("Unknown")):(await t.fa.stop(),sa(t))})),t.fa}function _a(t){return t.ga||(t.ga=function(t,e,n){const r=ge(t);return r.oa(),new zo(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{e_:()=>Promise.resolve(),n_:ya.bind(null,t),i_:ba.bind(null,t),na:va.bind(null,t),ra:wa.bind(null,t)}),t.Aa.push(async e=>{e?(t.ga.L_(),await da(t)):(await t.ga.stop(),t.Ia.length>0&&(ce(Qo,`Stopping write stream with ${t.Ia.length} pending writes`),t.Ia=[]))})),t.ga}class Ca{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new ve,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(t=>{})}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new Ca(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new ye(me.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(t=>this.deferred.resolve(t))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ia(t,e){if(ue("AsyncQueue",`${e}: ${t}`),Ye(t))return new ye(me.UNAVAILABLE,`${e}: ${t}`);throw t}class Sa{static emptySet(t){return new Sa(t.comparator)}constructor(t){this.comparator=t?(e,n)=>t(e,n)||ze.comparator(e.key,n.key):(t,e)=>ze.comparator(t.key,e.key),this.keyedMap=ti(),this.sortedSet=new wn(this.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal((e,n)=>(t(e),!1))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Sa))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach(e=>{t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Sa;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Aa{constructor(){this.pa=new wn(ze.comparator)}track(t){const e=t.doc.key,n=this.pa.get(e);n?0!==t.type&&3===n.type?this.pa=this.pa.insert(e,t):3===t.type&&1!==n.type?this.pa=this.pa.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.pa=this.pa.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.pa=this.pa.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.pa=this.pa.remove(e):1===t.type&&2===n.type?this.pa=this.pa.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.pa=this.pa.insert(e,{type:2,doc:t.doc}):de(63341,{Vt:t,ya:n}):this.pa=this.pa.insert(e,t)}wa(){const t=[];return this.pa.inorderTraversal((e,n)=>{t.push(n)}),t}}class Da{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach(t=>{s.push({type:0,doc:t})}),new Da(t,e,Sa.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&zr(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class ka{constructor(){this.ba=void 0,this.Sa=[]}Da(){return this.Sa.some(t=>t.va())}}class Na{constructor(){this.queries=xa(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(t,e){const n=ge(t),r=n.queries;n.queries=xa(),r.forEach((t,n)=>{for(const t of n.Sa)t.onError(e)})}(this,new ye(me.ABORTED,"Firestore shutting down"))}}function xa(){return new Xr(t=>Kr(t),zr)}function Ra(t,e){const n=ge(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.Sa)e.Ma(t)&&(r=!0);i.ba=t}}r&&La(n)}function Oa(t,e,n){const r=ge(t),i=r.queries.get(e);if(i)for(const t of i.Sa)t.onError(n);r.queries.delete(e)}function La(t){t.Ca.forEach(t=>{t.next()})}var Ma,Pa;(Pa=Ma||(Ma={})).xa="default",Pa.Cache="cache";class Va{constructor(t,e,n){this.query=t,this.Oa=e,this.Na=!1,this.Ba=null,this.onlineState="Unknown",this.options=n||{}}Ma(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new Da(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Na?this.La(t)&&(this.Oa.next(t),e=!0):this.ka(t,this.onlineState)&&(this.qa(t),e=!0),this.Ba=t,e}onError(t){this.Oa.error(t)}Fa(t){this.onlineState=t;let e=!1;return this.Ba&&!this.Na&&this.ka(this.Ba,t)&&(this.qa(this.Ba),e=!0),e}ka(t,e){if(!t.fromCache)return!0;if(!this.va())return!0;const n="Offline"!==e;return(!this.options.Qa||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}La(t){if(t.docChanges.length>0)return!0;const e=this.Ba&&this.Ba.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}qa(t){t=Da.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Na=!0,this.Oa.next(t)}va(){return this.options.source!==Ma.Cache}}class Fa{constructor(t){this.key=t}}class Ua{constructor(t){this.key=t}}class Ba{constructor(t,e){this.query=t,this.Ha=e,this.Ja=null,this.hasCachedResults=!1,this.current=!1,this.Ya=ai(),this.mutatedKeys=ai(),this.Za=Qr(t),this.Xa=new Sa(this.Za)}get eu(){return this.Ha}tu(t,e){const n=e?e.nu:new Aa,r=e?e.Xa:this.Xa;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal((t,e)=>{const u=r.get(t),h=Gr(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.ru(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.Za(h,a)>0||c&&this.Za(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{Xa:s,nu:n,Cs:o,mutatedKeys:i}}ru(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.Xa;this.Xa=t.Xa,this.mutatedKeys=t.mutatedKeys;const s=t.nu.wa();s.sort((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return de(20277,{Vt:t})}};return n(t)-n(e)}(t.type,e.type)||this.Za(t.doc,e.doc)),this.iu(n),r=null!=r&&r;const o=e&&!r?this.su():[],a=0===this.Ya.size&&this.current&&!r?1:0,c=a!==this.Ja;return this.Ja=a,0!==s.length||c?{snapshot:new Da(this.query,t.Xa,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),ou:o}:{ou:o}}Fa(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({Xa:this.Xa,nu:new Aa,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{ou:[]}}_u(t){return!this.Ha.has(t)&&!!this.Xa.has(t)&&!this.Xa.get(t).hasLocalMutations}iu(t){t&&(t.addedDocuments.forEach(t=>this.Ha=this.Ha.add(t)),t.modifiedDocuments.forEach(t=>{}),t.removedDocuments.forEach(t=>this.Ha=this.Ha.delete(t)),this.current=t.current)}su(){if(!this.current)return[];const t=this.Ya;this.Ya=ai(),this.Xa.forEach(t=>{this._u(t.key)&&(this.Ya=this.Ya.add(t.key))});const e=[];return t.forEach(t=>{this.Ya.has(t)||e.push(new Ua(t))}),this.Ya.forEach(n=>{t.has(n)||e.push(new Fa(n))}),e}au(t){this.Ha=t.$s,this.Ya=ai();const e=this.tu(t.documents);return this.applyChanges(e,!0)}uu(){return Da.fromInitialDocuments(this.query,this.Xa,this.mutatedKeys,0===this.Ja,this.hasCachedResults)}}const ja="SyncEngine";class qa{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class $a{constructor(t){this.key=t,this.cu=!1}}class za{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.lu={},this.hu=new Xr(t=>Kr(t),zr),this.Pu=new Map,this.Tu=new Set,this.Iu=new wn(ze.comparator),this.Eu=new Map,this.du=new io,this.Au={},this.Ru=new Map,this.Vu=Hs.lr(),this.onlineState="Unknown",this.mu=void 0}get isPrimaryClient(){return!0===this.mu}}async function Ka(t,e,n=!0){const r=lc(t);let i;const s=r.hu.get(e);return s?(r.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.uu()):i=await Ga(r,e,n,!0),i}async function Ha(t,e){const n=lc(t);await Ga(n,e,!0,!1)}async function Ga(t,e,n,r){const i=await function(t,e){const n=ge(t);return n.persistence.runTransaction("Allocate target","readwrite",t=>{let r;return n.Ti.getTargetData(t,e).next(i=>i?(r=i,Xe.resolve(r)):n.Ti.allocateTargetId(t).next(i=>(r=new Vs(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Ti.addTargetData(t,r).next(()=>r))))}).then(t=>{const r=n.xs.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.xs=n.xs.insert(t.targetId,t),n.Os.set(e,t.targetId)),t})}(t.localStore,qr(e)),s=i.targetId,o=t.sharedClientState.addLocalQueryTarget(s,n);let a;return r&&(a=await async function(t,e,n,r,i){t.fu=(e,n,r)=>async function(t,e,n,r){let i=e.view.tu(n);i.Cs&&(i=await Co(t.localStore,e.query,!1).then(({documents:t})=>e.view.tu(t,i)));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return sc(t,e.targetId,a.ou),a.snapshot}(t,e,n,r);const s=await Co(t.localStore,e,!0),o=new Ba(e,s.$s),a=o.tu(s.documents),c=Zi.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);sc(t,n,u.ou);const h=new qa(e,n,o);return t.hu.set(e,h),t.Pu.has(n)?t.Pu.get(n).push(e):t.Pu.set(n,[e]),u.snapshot}(t,e,s,"current"===o,i.resumeToken)),t.isPrimaryClient&&n&&Jo(t.remoteStore,i),a}async function Qa(t,e,n){const r=ge(t),i=r.hu.get(e),s=r.Pu.get(i.targetId);if(s.length>1)return r.Pu.set(i.targetId,s.filter(t=>!zr(t,e))),void r.hu.delete(e);r.isPrimaryClient?(r.sharedClientState.removeLocalQueryTarget(i.targetId),r.sharedClientState.isActiveQueryTarget(i.targetId)||await _o(r.localStore,i.targetId,!1).then(()=>{r.sharedClientState.clearQueryState(i.targetId),n&&Zo(r.remoteStore,i.targetId),rc(r,i.targetId)}).catch(We)):(rc(r,i.targetId),await _o(r.localStore,i.targetId,!0))}async function Wa(t,e){const n=ge(t),r=n.hu.get(e),i=n.Pu.get(r.targetId);n.isPrimaryClient&&1===i.length&&(n.sharedClientState.removeLocalQueryTarget(r.targetId),Zo(n.remoteStore,r.targetId))}async function Xa(t,e){const n=ge(t);try{const t=await function(t,e){const n=ge(t),r=e.snapshotVersion;let i=n.xs;return n.persistence.runTransaction("Apply remote event","readwrite-primary",t=>{const s=n.Bs.newChangeBuffer({trackRemovals:!0});i=n.xs;const o=[];e.targetChanges.forEach((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Ti.removeMatchingKeys(t,s.removedDocuments,a).next(()=>n.Ti.addMatchingKeys(t,s.addedDocuments,a)));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Sn.EMPTY_BYTE_STRING,Fe.min()).withLastLimboFreeSnapshotVersion(Fe.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Ti.updateTargetData(t,u))});let a=Jr(),c=ai();if(e.documentUpdates.forEach(r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),o.push(function(t,e,n){let r=ai(),i=ai();return n.forEach(t=>r=r.add(t)),e.getEntries(t,r).next(t=>{let r=Jr();return n.forEach((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(Fe.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):ce(vo,"Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)}),{qs:r,Qs:i}})}(t,s,e.documentUpdates).next(t=>{a=t.qs,c=t.Qs})),!r.isEqual(Fe.min())){const e=n.Ti.getLastRemoteSnapshotVersion(t).next(e=>n.Ti.setTargetsMetadata(t,t.currentSequenceNumber,r));o.push(e)}return Xe.waitFor(o).next(()=>s.apply(t)).next(()=>n.localDocuments.getLocalViewOfDocuments(t,a,c)).next(()=>a)}).then(t=>(n.xs=i,t))}(n.localStore,e);e.targetChanges.forEach((t,e)=>{const r=n.Eu.get(e);r&&(pe(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1,22616),t.addedDocuments.size>0?r.cu=!0:t.modifiedDocuments.size>0?pe(r.cu,14607):t.removedDocuments.size>0&&(pe(r.cu,42227),r.cu=!1))}),await cc(n,t,e)}catch(t){await We(t)}}function Ya(t,e,n){const r=ge(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.hu.forEach((n,r)=>{const i=r.view.Fa(e);i.snapshot&&t.push(i.snapshot)}),function(t,e){const n=ge(t);n.onlineState=e;let r=!1;n.queries.forEach((t,n)=>{for(const t of n.Sa)t.Fa(e)&&(r=!0)}),r&&La(n)}(r.eventManager,e),t.length&&r.lu.Y_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Ja(t,e,n){const r=ge(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Eu.get(e),s=i&&i.key;if(s){let t=new wn(ze.comparator);t=t.insert(s,lr.newNoDocument(s,Fe.min()));const n=ai().add(s),i=new Ji(Fe.min(),new Map,new wn(Ne),t,n);await Xa(r,i),r.Iu=r.Iu.remove(s),r.Eu.delete(e),ac(r)}else await _o(r.localStore,e,!1).then(()=>rc(r,e,n)).catch(We)}async function Za(t,e){const n=ge(t),r=e.batch.batchId;try{const t=await function(t,e){const n=ge(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",t=>{const r=e.batch.keys(),i=n.Bs.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=Xe.resolve();return s.forEach(t=>{o=o.next(()=>r.getEntry(e,t)).next(e=>{const s=n.docVersions.get(t);pe(null!==s,48541),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))})}),o.next(()=>t.mutationQueue.removeMutationBatch(e,i))}(n,t,e,i).next(()=>i.apply(t)).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ai();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e))).next(()=>n.localDocuments.getDocuments(t,r))})}(n.localStore,e);nc(n,r,null),ec(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await cc(n,t)}catch(t){await We(t)}}async function tc(t,e,n){const r=ge(t);try{const t=await function(t,e){const n=ge(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next(e=>(pe(null!==e,37113),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e))).next(()=>n.mutationQueue.performConsistencyCheck(t)).next(()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e)).next(()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r)).next(()=>n.localDocuments.getDocuments(t,r))})}(r.localStore,e);nc(r,e,n),ec(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await cc(r,t)}catch(n){await We(n)}}function ec(t,e){(t.Ru.get(e)||[]).forEach(t=>{t.resolve()}),t.Ru.delete(e)}function nc(t,e,n){const r=ge(t);let i=r.Au[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Au[r.currentUser.toKey()]=i}}function rc(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.Pu.get(e))t.hu.delete(r),n&&t.lu.gu(r,n);t.Pu.delete(e),t.isPrimaryClient&&t.du.Hr(e).forEach(e=>{t.du.containsKey(e)||ic(t,e)})}function ic(t,e){t.Tu.delete(e.path.canonicalString());const n=t.Iu.get(e);null!==n&&(Zo(t.remoteStore,n),t.Iu=t.Iu.remove(e),t.Eu.delete(n),ac(t))}function sc(t,e,n){for(const r of n)r instanceof Fa?(t.du.addReference(r.key,e),oc(t,r)):r instanceof Ua?(ce(ja,"Document no longer in limbo: "+r.key),t.du.removeReference(r.key,e),t.du.containsKey(r.key)||ic(t,r.key)):de(19791,{pu:r})}function oc(t,e){const n=e.key,r=n.path.canonicalString();t.Iu.get(n)||t.Tu.has(r)||(ce(ja,"New document in limbo: "+n),t.Tu.add(r),ac(t))}function ac(t){for(;t.Tu.size>0&&t.Iu.size<t.maxConcurrentLimboResolutions;){const e=t.Tu.values().next().value;t.Tu.delete(e);const n=new ze(je.fromString(e)),r=t.Vu.next();t.Eu.set(r,new $a(n)),t.Iu=t.Iu.insert(n,r),Jo(t.remoteStore,new Vs(qr(Ur(n.path)),r,"TargetPurposeLimboResolution",Je.le))}}async function cc(t,e,n){const r=ge(t),i=[],s=[],o=[];r.hu.isEmpty()||(r.hu.forEach((t,a)=>{o.push(r.fu(a,e,n).then(t=>{var e;if((t||n)&&r.isPrimaryClient){const i=t?!t.fromCache:null===(e=null==n?void 0:n.targetChanges.get(a.targetId))||void 0===e?void 0:e.current;r.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(t){i.push(t);const e=go.Rs(a.targetId,t);s.push(e)}}))}),await Promise.all(o),r.lu.Y_(i),await async function(t,e){const n=ge(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",t=>Xe.forEach(e,e=>Xe.forEach(e.ds,r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r)).next(()=>Xe.forEach(e.As,r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))}catch(t){if(!Ye(t))throw t;ce(vo,"Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.xs.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.xs=n.xs.insert(e,i)}}}(r.localStore,s))}async function uc(t,e){const n=ge(t);if(!n.currentUser.isEqual(e)){ce(ja,"User change. New user:",e.toKey());const t=await bo(n.localStore,e);n.currentUser=e,function(t){t.Ru.forEach(t=>{t.forEach(t=>{t.reject(new ye(me.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.Ru.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await cc(n,t.ks)}}function hc(t,e){const n=ge(t),r=n.Eu.get(e);if(r&&r.cu)return ai().add(r.key);{let t=ai();const r=n.Pu.get(e);if(!r)return t;for(const e of r){const r=n.hu.get(e);t=t.unionWith(r.view.eu)}return t}}function lc(t){const e=ge(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Xa.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=hc.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Ja.bind(null,e),e.lu.Y_=Ra.bind(null,e.eventManager),e.lu.gu=Oa.bind(null,e.eventManager),e}function dc(t){const e=ge(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Za.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=tc.bind(null,e),e}class fc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=Uo(t.databaseInfo.databaseId),this.sharedClientState=this.bu(t),this.persistence=this.Su(t),await this.persistence.start(),this.localStore=this.Du(t),this.gcScheduler=this.vu(t,this.localStore),this.indexBackfillerScheduler=this.Cu(t,this.localStore)}vu(t,e){return null}Cu(t,e){return null}Du(t){return function(t,e,n,r){return new wo(t,e,n,r)}(this.persistence,new yo,t.initialUser,this.serializer)}Su(t){return new ho(fo.fi,this.serializer)}bu(t){return new So}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}fc.provider={build:()=>new fc};class pc extends fc{constructor(t){super(),this.cacheSizeBytes=t}vu(t,e){pe(this.persistence.referenceDelegate instanceof po,46915);const n=this.persistence.referenceDelegate.garbageCollector;return new Xs(n,t.asyncQueue,e)}Su(t){const e=void 0!==this.cacheSizeBytes?Ks.withCacheSize(this.cacheSizeBytes):Ks.DEFAULT;return new ho(t=>po.fi(t,e),this.serializer)}}class gc{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Ya(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=uc.bind(null,this.syncEngine),await async function(t,e){const n=ge(t);e?(n.da.delete(2),await Xo(n)):e||(n.da.add(2),await Yo(n),n.Va.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new Na}createDatastore(t){const e=Uo(t.databaseInfo.databaseId),n=function(t){return new Vo(t)}(t.databaseInfo);return function(t,e,n,r){return new Ho(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new Wo(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,t=>Ya(this.syncEngine,t,0),ko.C()?new ko:new Ao)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new za(t,e,n,r,i,s);return o&&(a.mu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t,e;await async function(t){const e=ge(t);ce(Qo,"RemoteStore shutting down."),e.da.add(5),await Yo(e),e.Ra.shutdown(),e.Va.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate(),null===(e=this.eventManager)||void 0===e||e.terminate()}}gc.provider={build:()=>new gc};class mc{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Mu(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Mu(this.observer.error,t):ue("Uncaught Error in snapshot listener:",t.toString()))}xu(){this.muted=!0}Mu(t,e){setTimeout(()=>{this.muted||t(e)},0)}}const yc="FirestoreClient";class vc{constructor(t,e,n,r,i){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=ie.UNAUTHENTICATED,this.clientId=ke.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(n,async t=>{ce(yc,"Received user=",t.uid),await this.authCredentialListener(t),this.user=t}),this.appCheckCredentials.start(n,t=>(ce(yc,"Received new app check token=",t),this.appCheckCredentialListener(t,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new ve;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Ia(e,"Failed to shutdown persistence");t.reject(n)}}),t.promise}}async function wc(t,e){t.asyncQueue.verifyOperationInProgress(),ce(yc,"Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener(async t=>{r.isEqual(t)||(await bo(e.localStore,t),r=t)}),e.persistence.setDatabaseDeletedListener(()=>t.terminate()),t._offlineComponents=e}async function bc(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ce(yc,"Using user provided OfflineComponentProvider");try{await wc(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===me.FAILED_PRECONDITION||t.code===me.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;he("Error using user provided cache. Falling back to memory cache: "+n),await wc(t,new fc)}}else ce(yc,"Using default OfflineComponentProvider"),await wc(t,new pc(void 0));return t._offlineComponents}(t);ce(yc,"Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener(t=>Ea(e.remoteStore,t)),t.setAppCheckTokenChangeListener((t,n)=>Ea(e.remoteStore,n)),t._onlineComponents=e}async function Ec(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ce(yc,"Using user provided OnlineComponentProvider"),await bc(t,t._uninitializedComponentsProvider._online)):(ce(yc,"Using default OnlineComponentProvider"),await bc(t,new gc))),t._onlineComponents}async function Tc(t){const e=await Ec(t),n=e.eventManager;return n.onListen=Ka.bind(null,e.syncEngine),n.onUnlisten=Qa.bind(null,e.syncEngine),n.onFirstRemoteStoreListen=Ha.bind(null,e.syncEngine),n.onLastRemoteStoreUnlisten=Wa.bind(null,e.syncEngine),n}function _c(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const Cc=new Map;function Ic(t){if(!ze.isDocumentKey(t))throw new ye(me.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Sc(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":de(12329,{type:typeof t})}function Ac(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new ye(me.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=Sc(t);throw new ye(me.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}const Dc="firestore.googleapis.com",kc=!0;class Nc{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new ye(me.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Dc,this.ssl=kc}else this.host=t.host,this.ssl=null!==(e=t.ssl)&&void 0!==e?e:kc;if(this.isUsingEmulator=void 0!==t.emulatorOptions,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=zs;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new ye(me.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new ye(me.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=_c(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new ye(me.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new ye(me.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new ye(me.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class xc{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Nc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new ye(me.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new ye(me.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Nc(t),this._emulatorOptions=t.emulatorOptions||{},void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new be;switch(t.type){case"firstParty":return new Ce(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new ye(me.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=Cc.get(t);e&&(ce("ComponentProvider","Removing Datastore"),Cc.delete(t),e.terminate())}(this),Promise.resolve()}}class Rc{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Rc(this.firestore,t,this._query)}}class Oc{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Lc(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Oc(this.firestore,t,this._key)}}class Lc extends Rc{constructor(t,e,n){super(t,e,Ur(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Oc(this.firestore,null,new ze(t))}withConverter(t){return new Lc(this.firestore,t,this._path)}}function Mc(t,e,...n){if(t=v(t),1===arguments.length&&(e=ke.newId()),function(t,e,n){if(!n)throw new ye(me.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("doc","path",e),t instanceof xc){const r=je.fromString(e,...n);return Ic(r),new Oc(t,null,new ze(r))}{if(!(t instanceof Oc||t instanceof Lc))throw new ye(me.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(je.fromString(e,...n));return Ic(r),new Oc(t.firestore,t instanceof Lc?t.converter:null,new ze(r))}}const Pc="AsyncQueue";class Vc{constructor(t=Promise.resolve()){this.Ju=[],this.Yu=!1,this.Zu=[],this.Xu=null,this.ec=!1,this.tc=!1,this.nc=[],this.x_=new Bo(this,"async_queue_retry"),this.rc=()=>{const t=Fo();t&&ce(Pc,"Visibility state changed to "+t.visibilityState),this.x_.b_()},this.sc=t;const e=Fo();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.rc)}get isShuttingDown(){return this.Yu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.oc(),this._c(t)}enterRestrictedMode(t){if(!this.Yu){this.Yu=!0,this.tc=t||!1;const e=Fo();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.rc)}}enqueue(t){if(this.oc(),this.Yu)return new Promise(()=>{});const e=new ve;return this._c(()=>this.Yu&&this.tc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise)).then(()=>e.promise)}enqueueRetryable(t){this.enqueueAndForget(()=>(this.Ju.push(t),this.ac()))}async ac(){if(0!==this.Ju.length){try{await this.Ju[0](),this.Ju.shift(),this.x_.reset()}catch(t){if(!Ye(t))throw t;ce(Pc,"Operation failed with retryable error: "+t)}this.Ju.length>0&&this.x_.y_(()=>this.ac())}}_c(t){const e=this.sc.then(()=>(this.ec=!0,t().catch(t=>{throw this.Xu=t,this.ec=!1,ue("INTERNAL UNHANDLED ERROR: ",Fc(t)),t}).then(t=>(this.ec=!1,t))));return this.sc=e,e}enqueueAfterDelay(t,e,n){this.oc(),this.nc.indexOf(t)>-1&&(e=0);const r=Ca.createAndSchedule(this,t,e,n,t=>this.uc(t));return this.Zu.push(r),r}oc(){this.Xu&&de(47125,{cc:Fc(this.Xu)})}verifyOperationInProgress(){}async lc(){let t;do{t=this.sc,await t}while(t!==this.sc)}hc(t){for(const e of this.Zu)if(e.timerId===t)return!0;return!1}Pc(t){return this.lc().then(()=>{this.Zu.sort((t,e)=>t.targetTimeMs-e.targetTimeMs);for(const e of this.Zu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.lc()})}Tc(t){this.nc.push(t)}uc(t){const e=this.Zu.indexOf(t);this.Zu.splice(e,1)}}function Fc(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}function Uc(t){return function(t){if("object"!=typeof t||null===t)return!1;const e=t;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(t)}class Bc extends xc{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new Vc,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new Vc(t),this._firestoreClient=void 0,await t}}}function jc(t){if(t._terminated)throw new ye(me.FAILED_PRECONDITION,"The client has already been terminated.");return t._firestoreClient||function(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Fn(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,_c(r.experimentalLongPollingOptions),r.useFetchStreams,r.isUsingEmulator)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._componentsProvider||(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),t._firestoreClient=new vc(t._authCredentials,t._appCheckCredentials,t._queue,s,t._componentsProvider&&function(t){const e=null==t?void 0:t._online.build();return{_offline:null==t?void 0:t._offline.build(e),_online:e}}(t._componentsProvider))}(t),t._firestoreClient}class qc{constructor(t){this._byteString=t}static fromBase64String(t){try{return new qc(Sn.fromBase64String(t))}catch(t){throw new ye(me.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new qc(Sn.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class $c{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new ye(me.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $e(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class zc{constructor(t){this._methodName=t}}class Kc{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new ye(me.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new ye(me.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return Ne(this._lat,t._lat)||Ne(this._long,t._long)}}class Hc{constructor(t){this._values=(t||[]).map(t=>t)}toArray(){return this._values.map(t=>t)}isEqual(t){return function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(t[n]!==e[n])return!1;return!0}(this._values,t._values)}}const Gc=/^__.*__$/;class Qc{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return null!==this.fieldMask?new Li(t,this.data,this.fieldMask,e,this.fieldTransforms):new Oi(t,this.data,e,this.fieldTransforms)}}function Wc(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw de(40011,{Ic:t})}}class Xc{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Ec(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ic(){return this.settings.Ic}dc(t){return new Xc(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ac(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.dc({path:n,Rc:!1});return r.Vc(t),r}mc(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.dc({path:n,Rc:!1});return r.Ec(),r}fc(t){return this.dc({path:void 0,Rc:!0})}gc(t){return au(t,this.settings.methodName,this.settings.yc||!1,this.path,this.settings.wc)}contains(t){return void 0!==this.fieldMask.find(e=>t.isPrefixOf(e))||void 0!==this.fieldTransforms.find(e=>t.isPrefixOf(e.field))}Ec(){if(this.path)for(let t=0;t<this.path.length;t++)this.Vc(this.path.get(t))}Vc(t){if(0===t.length)throw this.gc("Document fields must not be empty");if(Wc(this.Ic)&&Gc.test(t))throw this.gc('Document fields cannot begin and end with "__"')}}class Yc{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Uo(t)}bc(t,e,n,r=!1){return new Xc({Ic:t,methodName:e,wc:n,path:$e.emptyPath(),Rc:!1,yc:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function Jc(t){const e=t._freezeSettings(),n=Uo(t._databaseId);return new Yc(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Zc(t,e,n,r,i,s={}){const o=t.bc(s.merge||s.mergeFields?2:0,e,n,i);ru("Data must be an object, but it was:",o,r);const a=eu(r,o);let c,u;if(s.merge)c=new Cn(o.fieldMask),u=o.fieldTransforms;else if(s.mergeFields){const t=[];for(const r of s.mergeFields){const i=iu(e,r,n);if(!o.contains(i))throw new ye(me.INVALID_ARGUMENT,`Field '${i}' is specified in your field mask but missing from your input data.`);cu(t,i)||t.push(i)}c=new Cn(t),u=o.fieldTransforms.filter(t=>c.covers(t.field))}else c=null,u=o.fieldTransforms;return new Qc(new ur(a),c,u)}function tu(t,e){if(nu(t=v(t)))return ru("Unsupported field value:",e,t),eu(t,e);if(t instanceof zc)return function(t,e){if(!Wc(e.Ic))throw e.gc(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.gc(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Rc&&4!==e.Ic)throw e.gc("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=tu(i,e.fc(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=v(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return li(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=Ve.fromDate(t);return{timestampValue:ds(e.serializer,n)}}if(t instanceof Ve){const n=new Ve(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:ds(e.serializer,n)}}if(t instanceof Kc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof qc)return{bytesValue:fs(e.serializer,t._byteString)};if(t instanceof Oc){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.gc(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:ms(t.firestore._databaseId||e.databaseId,t._key.path)}}if(t instanceof Hc)return function(t,e){return{mapValue:{fields:{[jn]:{stringValue:zn},[Kn]:{arrayValue:{values:t.toArray().map(t=>{if("number"!=typeof t)throw e.gc("VectorValues must only contain numeric values.");return ui(e.serializer,t)})}}}}}}(t,e);throw e.gc(`Unsupported field value: ${Sc(t)}`)}(t,e)}function eu(t,e){const n={};return vn(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):yn(t,(t,r)=>{const i=tu(r,e.Ac(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function nu(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Ve||t instanceof Kc||t instanceof qc||t instanceof Oc||t instanceof zc||t instanceof Hc)}function ru(t,e,n){if(!nu(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=Sc(n);throw"an object"===r?e.gc(t+" a custom object"):e.gc(t+" "+r)}}function iu(t,e,n){if((e=v(e))instanceof $c)return e._internalPath;if("string"==typeof e)return ou(t,e);throw au("Field path arguments must be of type string or ",t,!1,void 0,n)}const su=new RegExp("[~\\*/\\[\\]]");function ou(t,e,n){if(e.search(su)>=0)throw au(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new $c(...e.split("."))._internalPath}catch(r){throw au(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function au(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new ye(me.INVALID_ARGUMENT,a+t+c)}function cu(t,e){return t.some(t=>t.isEqual(e))}class uu{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Oc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new hu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(lu("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class hu extends uu{data(){return super.data()}}function lu(t,e){return"string"==typeof e?ou(t,e):e instanceof $c?e._internalPath:e._delegate._internalPath}class du{convertValue(t,e="none"){switch(Hn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return kn(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Nn(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw de(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return yn(t,(t,r)=>{n[t]=this.convertValue(r,e)}),n}convertVectorValue(t){var e,n,r;const i=null===(r=null===(n=null===(e=t.fields)||void 0===e?void 0:e[Kn].arrayValue)||void 0===n?void 0:n.values)||void 0===r?void 0:r.map(t=>kn(t.doubleValue));return new Hc(i)}convertGeoPoint(t){return new Kc(kn(t.latitude),kn(t.longitude))}convertArray(t,e){return(t.values||[]).map(t=>this.convertValue(t,e))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Pn(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Vn(t));default:return null}}convertTimestamp(t){const e=Dn(t);return new Ve(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=je.fromString(t);pe(Ps(n),9688,{name:t});const r=new Bn(n.get(1),n.get(3)),i=new ze(n.popFirst(5));return r.isEqual(e)||ue(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class fu{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class pu extends uu{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new gu(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(lu("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class gu extends pu{data(t={}){return super.data(t)}}class mu{constructor(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new fu(r.hasPendingWrites,r.fromCache),this.query=n}get docs(){const t=[];return this.forEach(e=>t.push(e)),t}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(t,e){this._snapshot.docs.forEach(n=>{t.call(e,new gu(this._firestore,this._userDataWriter,n.key,n,new fu(this._snapshot.mutatedKeys.has(n.key),this._snapshot.fromCache),this.query.converter))})}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new ye(me.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){let e=0;return t._snapshot.docChanges.map(n=>{const r=new gu(t._firestore,t._userDataWriter,n.doc.key,n.doc,new fu(t._snapshot.mutatedKeys.has(n.doc.key),t._snapshot.fromCache),t.query.converter);return n.doc,{type:"added",doc:r,oldIndex:-1,newIndex:e++}})}{let n=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(t=>e||3!==t.type).map(e=>{const r=new gu(t._firestore,t._userDataWriter,e.doc.key,e.doc,new fu(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter);let i=-1,s=-1;return 0!==e.type&&(i=n.indexOf(e.doc.key),n=n.delete(e.doc.key)),1!==e.type&&(n=n.add(e.doc),s=n.indexOf(e.doc.key)),{type:yu(e.type),doc:r,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}}function yu(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return de(61501,{type:t})}}class vu extends du{constructor(t){super(),this.firestore=t}convertBytes(t){return new qc(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Oc(this.firestore,null,e)}}function wu(t,e,n){t=Ac(t,Oc);const r=Ac(t.firestore,Bc),i=function(t,e,n){let r;return r=t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e,r}(t.converter,e,n);return function(t,e){return function(t,e){const n=new ve;return t.asyncQueue.enqueueAndForget(async()=>async function(t,e,n){const r=dc(t);try{const t=await function(t,e){const n=ge(t),r=Ve.now(),i=e.reduce((t,e)=>t.add(e.key),ai());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",t=>{let a=Jr(),c=ai();return n.Bs.getEntries(t,i).next(t=>{a=t,a.forEach((t,e)=>{e.isValidDocument()||(c=c.add(t))})}).next(()=>n.localDocuments.getOverlayedDocuments(t,a)).next(i=>{s=i;const o=[];for(const t of e){const e=xi(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new Li(t.key,e,hr(e.value.mapValue),Ii.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)}).next(e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)})}).then(()=>({batchId:o.batchId,changes:ei(s)}))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Au[t.currentUser.toKey()];r||(r=new wn(Ne)),r=r.insert(e,n),t.Au[t.currentUser.toKey()]=r}(r,t.batchId,n),await cc(r,t.changes),await da(r.remoteStore)}catch(t){const e=Ia(t,"Failed to persist write");n.reject(e)}}(await function(t){return Ec(t).then(t=>t.syncEngine)}(t),e,n)),n.promise}(jc(t),e)}(r,[Zc(Jc(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,Ii.none())])}function bu(t,...e){var n,r,i;t=v(t);let s={includeMetadataChanges:!1,source:"default"},o=0;"object"!=typeof e[o]||Uc(e[o])||(s=e[o],o++);const a={includeMetadataChanges:s.includeMetadataChanges,source:s.source};if(Uc(e[o])){const t=e[o];e[o]=null===(n=t.next)||void 0===n?void 0:n.bind(t),e[o+1]=null===(r=t.error)||void 0===r?void 0:r.bind(t),e[o+2]=null===(i=t.complete)||void 0===i?void 0:i.bind(t)}let c,u,h;if(t instanceof Oc)u=Ac(t.firestore,Bc),h=Ur(t._key.path),c={next:n=>{e[o]&&e[o](function(t,e,n){const r=n.docs.get(e._key),i=new vu(t);return new pu(t,i,e._key,r,new fu(n.hasPendingWrites,n.fromCache),e.converter)}(u,t,n))},error:e[o+1],complete:e[o+2]};else{const n=Ac(t,Rc);u=Ac(n.firestore,Bc),h=n._query;const r=new vu(u);c={next:t=>{e[o]&&e[o](new mu(u,r,n,t))},error:e[o+1],complete:e[o+2]},function(t){if("L"===t.limitType&&0===t.explicitOrderBy.length)throw new ye(me.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}(t._query)}return function(t,e,n,r){const i=new mc(r),s=new Va(e,i,n);return t.asyncQueue.enqueueAndForget(async()=>async function(t,e){const n=ge(t);let r=3;const i=e.query;let s=n.queries.get(i);s?!s.Da()&&e.va()&&(r=2):(s=new ka,r=e.va()?0:1);try{switch(r){case 0:s.ba=await n.onListen(i,!0);break;case 1:s.ba=await n.onListen(i,!1);break;case 2:await n.onFirstRemoteStoreListen(i)}}catch(t){const n=Ia(t,`Initialization of query '${Hr(e.query)}' failed`);return void e.onError(n)}n.queries.set(i,s),s.Sa.push(e),e.Fa(n.onlineState),s.ba&&e.Ma(s.ba)&&La(n)}(await Tc(t),s)),()=>{i.xu(),t.asyncQueue.enqueueAndForget(async()=>async function(t,e){const n=ge(t),r=e.query;let i=3;const s=n.queries.get(r);if(s){const t=s.Sa.indexOf(e);t>=0&&(s.Sa.splice(t,1),0===s.Sa.length?i=e.va()?0:1:!s.Da()&&e.va()&&(i=2))}switch(i){case 0:return n.queries.delete(r),n.onUnlisten(r,!0);case 1:return n.queries.delete(r),n.onUnlisten(r,!1);case 2:return n.onLastRemoteStoreUnlisten(r);default:return}}(await Tc(t),s))}}(jc(u),h,a,c)}function Eu(t){return Eu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Eu(t)}function Tu(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,s,o,a=[],c=!0,u=!1;try{if(s=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=s.call(n)).done)&&(a.push(r.value),a.length!==e);c=!0);}catch(t){u=!0,i=t}finally{try{if(!c&&null!=n.return&&(o=n.return(),Object(o)!==o))return}finally{if(u)throw i}}return a}}(t,e)||function(t,e){if(t){if("string"==typeof t)return _u(t,e);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_u(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _u(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);n<e;n++)r[n]=t[n];return r}function Cu(){var t,e,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function s(n,r,i,s){var c=r&&r.prototype instanceof a?r:a,u=Object.create(c.prototype);return Iu(u,"_invoke",function(n,r,i){var s,a,c,u=0,h=i||[],l=!1,d={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(e,n){return s=e,a=0,c=t,d.n=n,o}};function f(n,r){for(a=n,c=r,e=0;!l&&u&&!i&&e<h.length;e++){var i,s=h[e],f=d.p,p=s[2];n>3?(i=p===r)&&(c=s[(a=s[4])?5:(a=3,3)],s[4]=s[5]=t):s[0]<=f&&((i=n<2&&f<s[1])?(a=0,d.v=r,d.n=s[1]):f<p&&(i=n<3||s[0]>r||r>p)&&(s[4]=n,s[5]=r,d.n=p,a=0))}if(i||n>1)return o;throw l=!0,r}return function(i,h,p){if(u>1)throw TypeError("Generator is already running");for(l&&1===h&&f(h,p),a=h,c=p;(e=a<2?t:c)||!l;){s||(a?a<3?(a>1&&(d.n=-1),f(a,c)):d.n=c:d.v=c);try{if(u=2,s){if(a||(i="next"),e=s[i]){if(!(e=e.call(s,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=s.return)&&e.call(s),a<2&&(c=TypeError("The iterator does not provide a '"+i+"' method"),a=1);s=t}else if((e=(l=d.n<0)?c:n.call(r,d))!==o)break}catch(e){s=t,a=1,c=e}finally{u=1}}return{value:e,done:l}}}(n,i,s),!0),u}var o={};function a(){}function c(){}function u(){}e=Object.getPrototypeOf;var h=[][r]?e(e([][r]())):(Iu(e={},r,function(){return this}),e),l=u.prototype=a.prototype=Object.create(h);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,u):(t.__proto__=u,Iu(t,i,"GeneratorFunction")),t.prototype=Object.create(l),t}return c.prototype=u,Iu(l,"constructor",u),Iu(u,"constructor",c),c.displayName="GeneratorFunction",Iu(u,i,"GeneratorFunction"),Iu(l),Iu(l,i,"Generator"),Iu(l,r,function(){return this}),Iu(l,"toString",function(){return"[object Generator]"}),(Cu=function(){return{w:s,m:d}})()}function Iu(t,e,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}Iu=function(t,e,n,r){if(e)i?i(t,e,{value:n,enumerable:!r,configurable:!r,writable:!r}):t[e]=n;else{var s=function(e,n){Iu(t,e,function(t){return this._invoke(e,n,t)})};s("next",0),s("throw",1),s("return",2)}},Iu(t,e,n,r)}function Su(t,e,n){return(e=function(t){var e=function(t){if("object"!=Eu(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var n=e.call(t,"string");if("object"!=Eu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==Eu(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Au(t,e,n,r,i,s,o){try{var a=t[s](o),c=a.value}catch(t){return void n(t)}a.done?e(c):Promise.resolve(c).then(r,i)}function Du(t){return function(){var e=this,n=arguments;return new Promise(function(r,i){var s=t.apply(e,n);function o(t){Au(s,r,i,o,a,"next",t)}function a(t){Au(s,r,i,o,a,"throw",t)}o(void 0)})}}new WeakMap,function(t,e=!0){se="11.9.0",Dt(new w("firestore",(t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new Bc(new Te(t.getProvider("auth-internal")),new Se(i,t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new ye(me.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Bn(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s},"PUBLIC").setMultipleInstances(!0)),Rt(ne,re,t),Rt(ne,re,"esm2017")}();var ku="activityLog",Nu="settings",xu="patterns",Ru={trackingEnabled:!0,interventionLevel:"medium",dailyFocusGoal:6,distractionThreshold:15},Ou=function(t){const e="object"==typeof t?t:function(t=Tt){const e=Ct.get(t);if(!e&&t===Tt&&o())return xt();if(!e)throw kt.create("no-app",{appName:t});return e}(),n="string"==typeof t?t:Un,r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}(e,"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=s())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;t=Ac(t,xc);const o=c(e),a=t._getSettings(),u=Object.assign(Object.assign({},a),{emulatorOptions:t._getEmulatorOptions()}),h=`${e}:${n}`;o&&(async function(t){(await fetch(t,{credentials:"include"})).ok}(`https://${h}`),l("Firestore",!0)),a.host!==Dc&&a.host!==h&&he("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const d=Object.assign(Object.assign({},a),{host:h,ssl:o,emulatorOptions:r});if(!m(d,u)&&(t._setSettings(d),r.mockUserToken)){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=ie.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[i(JSON.stringify({alg:"none",type:"JWT"})),i(JSON.stringify(o)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const o=r.mockUserToken.sub||r.mockUserToken.user_id;if(!o)throw new ye(me.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new ie(o)}t._authCredentials=new Ee(new we(e,n))}}(r,...t)}return r}(xt({apiKey:"YOUR_API_KEY",authDomain:"YOUR_AUTH_DOMAIN",projectId:"YOUR_PROJECT_ID",storageBucket:"YOUR_STORAGE_BUCKET",messagingSenderId:"YOUR_MESSAGING_SENDER_ID",appId:"YOUR_APP_ID"})),Lu="demo-user",Mu=Mc(Ou,"users",Lu,"data","activityLog"),Pu=Mc(Ou,"users",Lu,"data","settings");function Vu(t,e){return JSON.stringify(t)===JSON.stringify(e)}function Fu(){return(Fu=Du(Cu().m(function t(e){var n;return Cu().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,wu(Mu,{activityLog:e});case 1:t.n=3;break;case 2:t.p=2,n=t.v,console.error("Failed to sync activityLog to backend:",n);case 3:return t.a(2)}},t,null,[[0,2]])}))).apply(this,arguments)}function Uu(){return(Uu=Du(Cu().m(function t(e){var n;return Cu().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,wu(Pu,{settings:e});case 1:t.n=3;break;case 2:t.p=2,n=t.v,console.error("Failed to sync settings to backend:",n);case 3:return t.a(2)}},t,null,[[0,2]])}))).apply(this,arguments)}var Bu=null,ju=null;function qu(t){return $u.apply(this,arguments)}function $u(){return($u=Du(Cu().m(function t(e){var n,r,i,s;return Cu().w(function(t){for(;;)switch(t.n){case 0:if(e.url&&""!==e.url){t.n=1;break}return t.a(2);case 1:t.p=1,new URL(e.url),t.n=3;break;case 2:return t.p=2,t.v,console.error("Invalid URL:",e.url),t.a(2);case 3:return n={timestamp:Date.now(),url:e.url,title:e.title||"Untitled",duration:0},t.n=4,chrome.storage.local.get(ku);case 4:return r=t.v,(i=r.activityLog).length>0&&((s=i[i.length-1]).duration=n.timestamp-s.timestamp),i.push(n),t.n=5,chrome.storage.local.set(Su({},ku,i));case 5:zu();case 6:return t.a(2)}},t,null,[[1,2]])}))).apply(this,arguments)}function zu(){return Ku.apply(this,arguments)}function Ku(){return(Ku=Du(Cu().m(function t(){var e,n,r,i,s;return Cu().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.get(ku);case 1:return e=t.v,n=e.activityLog,t.n=2,chrome.storage.local.get(Nu);case 2:return r=t.v,i=r.settings,s=n.reduce(function(t,e){try{if(!e.url)return t;var n=new URL(e.url).hostname;if(!n)return t;t[n]||(t[n]={totalTime:0,visitCount:0,averageVisitDuration:0});var r="number"==typeof e.duration?e.duration:0;t[n].totalTime+=r,t[n].visitCount++,t[n].averageVisitDuration=t[n].totalTime/t[n].visitCount}catch(t){console.error("Error processing activity:",t,e)}return t},{}),t.n=3,chrome.storage.local.set(Su({},xu,s));case 3:Hu(s,i);case 4:return t.a(2)}},t)}))).apply(this,arguments)}function Hu(t,e){return Gu.apply(this,arguments)}function Gu(){return(Gu=Du(Cu().m(function t(e,n){var r,i,s,o,a,c,u,h,l;return Cu().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,e&&n&&n.distractionThreshold){t.n=1;break}return console.error("Invalid patterns or settings data"),t.a(2);case 1:r=60*n.distractionThreshold*1e3,i=0,s=Object.entries(e);case 2:if(!(i<s.length)){t.n=9;break}if(o=Tu(s[i],2),a=o[0],c=o[1],t.p=3,c&&"number"==typeof c.averageVisitDuration){t.n=4;break}return t.a(3,8);case 4:if(!(c.averageVisitDuration>r)){t.n=6;break}return t.n=5,chrome.tabs.query({active:!0,currentWindow:!0});case 5:if(!(u=t.v)[0]){t.n=6;break}return t.n=6,chrome.tabs.sendMessage(u[0].id,{type:"SHOW_INTERVENTION",data:{domain:a,timeSpent:c.averageVisitDuration}}).catch(function(t){return console.error("Error sending intervention message:",t)});case 6:t.n=8;break;case 7:t.p=7,h=t.v,console.error("Error processing pattern for domain:",a,h);case 8:i++,t.n=2;break;case 9:t.n=11;break;case 10:t.p=10,l=t.v,console.error("Error in checkForInterventions:",l);case 11:return t.a(2)}},t,null,[[3,7],[0,10]])}))).apply(this,arguments)}function Qu(){return Wu.apply(this,arguments)}function Wu(){return(Wu=Du(Cu().m(function t(){var e,n,r;return Cu().w(function(t){for(;;)switch(t.n){case 0:return t.p=0,t.n=1,chrome.storage.local.get(Nu);case 1:return e=t.v,n=e.settings,t.a(2,n&&"boolean"==typeof n.trackingEnabled?n.trackingEnabled:Ru.trackingEnabled);case 2:return t.p=2,r=t.v,console.error("Error checking tracking status:",r),t.a(2,Ru.trackingEnabled)}},t,null,[[0,2]])}))).apply(this,arguments)}bu(Mu,function(t){if(t.exists()){var e=t.data().activityLog;Vu(e,Bu)||(Bu=e,chrome.storage.local.set({activityLog:e}))}}),bu(Pu,function(t){if(t.exists()){var e=t.data().settings;Vu(e,ju)||(ju=e,chrome.storage.local.set({settings:e}))}}),chrome.storage.onChanged.addListener(function(t,e){"local"===e&&(t.activityLog&&!Vu(t.activityLog.newValue,Bu)&&(Bu=t.activityLog.newValue,function(t){Fu.apply(this,arguments)}(t.activityLog.newValue)),t.settings&&!Vu(t.settings.newValue,ju)&&(ju=t.settings.newValue,function(t){Uu.apply(this,arguments)}(t.settings.newValue)))}),chrome.runtime.onInstalled.addListener(Du(Cu().m(function t(){return Cu().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.storage.local.set(Su(Su(Su({},Nu,Ru),ku,[]),xu,[]));case 1:return t.a(2)}},t)}))),chrome.tabs.onActivated.addListener(function(){var t=Du(Cu().m(function t(e){return Cu().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Qu();case 1:if(t.v){t.n=2;break}return t.a(2);case 2:return t.n=3,chrome.tabs.get(e.tabId);case 3:qu(t.v);case 4:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}()),chrome.tabs.onUpdated.addListener(function(){var t=Du(Cu().m(function t(e,n,r){var i;return Cu().w(function(t){for(;;)switch(t.n){case 0:if(!(i="complete"===n.status)){t.n=2;break}return t.n=1,Qu();case 1:i=t.v;case 2:if(!i){t.n=3;break}qu(r);case 3:return t.a(2)}},t)}));return function(e,n,r){return t.apply(this,arguments)}}())})();